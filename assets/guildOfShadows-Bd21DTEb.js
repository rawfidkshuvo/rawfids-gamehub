import{c as qe,i as kt,g as St,a as At,r as u,e as Ct,o as Ue,d as C,j as e,H as Dt,S as Fe,X as q,n as Tt,s as Gt,h as Et,p as Rt,u as L,t as zt,q as pe,m as Ot}from"./x-vdu6PxPT.js";import{L as $t,S as Lt,B as je,C as he,a as Ne,b as we}from"./step-back-DgPuYW0s.js";import{G as Ie}from"./ghost-Ddz50Svz.js";import{L as Ye}from"./loader-circle-Dl3IVupC.js";import{C as fe}from"./crown-DhFWzZA3.js";import{U as Ze}from"./user-hi-jrCL7.js";import{T as Z}from"./trash-2-CC3Hg-Aa.js";import{T as Qe}from"./triangle-alert-CO8fZ1I9.js";import{S as Pt}from"./scale-CZFdUGY8.js";import{S as Ht}from"./shield-YRjbg8Vk.js";import{S as et}from"./search-Dn0gxp0x.js";import{B as Mt}from"./briefcase-ClWMkL6D.js";import{G as _t}from"./gavel-CJ-N0LgK.js";import{S as Bt}from"./skull--JE29QMg.js";import{D as Ut}from"./dice-5-kys5QpJR.js";import{H as Ft}from"./hand-D9d9Q_H-.js";import{C as H}from"./coins-FTQ8_pUL.js";import{H as Yt}from"./history-r3RmdCN7.js";import{C as Ke}from"./circle-play-CyvrsCHq.js";import{E as ve}from"./eye-ByZgRM3i.js";import{T as tt}from"./trophy-CV5zFLFQ.js";import{Z as Kt}from"./zap-BEeOHqdt.js";import{U as Wt}from"./users-Dsm1N_Bg.js";const Vt=[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]],Jt=qe("arrow-right-left",Vt);const Xt=[["path",{d:"M5 22h14",key:"ehvnwv"}],["path",{d:"M5 2h14",key:"pdyrp9"}],["path",{d:"M17 22v-4.172a2 2 0 0 0-.586-1.414L12 12l-4.414 4.414A2 2 0 0 0 7 17.828V22",key:"1d314k"}],["path",{d:"M7 2v4.172a2 2 0 0 0 .586 1.414L12 12l4.414-4.414A2 2 0 0 0 17 6.172V2",key:"1vvvr6"}]],qt=qe("hourglass",Xt),Zt={apiKey:"AIzaSyBjIjK53vVJW1y5RaqEFGSFp0ECVDBEe1o",authDomain:"game-hub-ff8aa.firebaseapp.com",projectId:"game-hub-ff8aa",storageBucket:"game-hub-ff8aa.firebasestorage.app",messagingSenderId:"586559578902",appId:"1:586559578902:web:91da4fa4ace038d16aa637"},st=kt(Zt),be=St(st),D=At(st),G=typeof __app_id<"u"?__app_id:"guild-shadows",Qt="15",We=3,m={URCHIN:{id:"URCHIN",name:"Street Urchin",type:"ACTION",cost:0,desc:"Gain 2 Gold from the supply.",icon:H,color:"text-amber-400",bg:"bg-amber-950",border:"border-amber-700"},THIEF:{id:"THIEF",name:"Master Thief",type:"ACTION",cost:0,desc:"Steal 2 Gold from a player.",icon:Ft,color:"text-purple-400",bg:"bg-purple-950",border:"border-purple-700"},HEIST:{id:"HEIST",name:"Grand Heist",type:"ACTION",cost:2,desc:"Risk: 50% get 5 Gold, 50% nothing.",icon:Ut,color:"text-orange-400",bg:"bg-orange-950",border:"border-orange-700"},ASSASSIN:{id:"ASSASSIN",name:"Night Blade",type:"ACTION",cost:2,desc:"Destroy a specific Agent.",icon:Bt,color:"text-red-500",bg:"bg-red-950",border:"border-red-800"},BLACKMAIL:{id:"BLACKMAIL",name:"Blackmail",type:"ACTION",cost:3,desc:"Steal an Agent OR Steal 4 Gold.",icon:_t,color:"text-pink-400",bg:"bg-pink-950",border:"border-pink-700"},DOPPELGANGER:{id:"DOPPELGANGER",name:"Doppelganger",type:"ACTION",cost:2,desc:"Copy effect of last Action card.",icon:Ne,color:"text-cyan-400",bg:"bg-cyan-950",border:"border-cyan-700"},MERCHANT:{id:"MERCHANT",name:"Silk Trader",type:"AGENT",cost:2,desc:"+1 Gold at start of your turn.",icon:Mt,color:"text-emerald-400",bg:"bg-emerald-900",border:"border-emerald-600"},LOOKOUT:{id:"LOOKOUT",name:"Lookout",type:"AGENT",cost:2,desc:"Peek at the top card of the deck.",icon:et,color:"text-indigo-300",bg:"bg-indigo-900",border:"border-indigo-600"},BODYGUARD:{id:"BODYGUARD",name:"Iron Guard",type:"AGENT",cost:4,desc:"Immune to theft & assassination.",icon:Ht,color:"text-blue-400",bg:"bg-blue-900",border:"border-blue-600"},POLITICIAN:{id:"POLITICIAN",name:"Corrupt Senator",type:"AGENT",cost:4,desc:"Gain 1 Gold when others play Actions.",icon:Pt,color:"text-yellow-200",bg:"bg-yellow-900",border:"border-yellow-600"},SABOTEUR:{id:"SABOTEUR",name:"Saboteur",type:"AGENT",cost:4,desc:"Others pay +1 Gold to play Actions.",icon:Qe,color:"text-orange-500",bg:"bg-stone-800",border:"border-orange-800"}},es=[...Array(6).fill("URCHIN"),...Array(5).fill("THIEF"),...Array(4).fill("HEIST"),...Array(3).fill("ASSASSIN"),...Array(3).fill("BLACKMAIL"),...Array(2).fill("DOPPELGANGER"),...Array(4).fill("MERCHANT"),...Array(3).fill("LOOKOUT"),...Array(3).fill("BODYGUARD"),...Array(2).fill("POLITICIAN"),...Array(2).fill("SABOTEUR")],Ve=r=>{let i=r.length,b;for(;i!==0;)b=Math.floor(Math.random()*i),i--,[r[i],r[b]]=[r[b],r[i]];return r},ge=()=>e.jsxs("div",{className:"flex items-center justify-center gap-1 opacity-40 mt-auto pb-2 pt-2 relative z-10",children:[e.jsx(Ie,{size:12,className:"text-purple-500"}),e.jsx("span",{className:"text-[10px] font-black tracking-widest text-purple-500 uppercase",children:"GUILD OF SHADOWS"})]}),Je=()=>e.jsxs("div",{className:"flex items-center justify-center gap-1 opacity-40 mt-auto pb-2 pt-2 relative z-10",children:[e.jsx(Ie,{size:22,className:"text-purple-500"}),e.jsx("span",{className:"text-[20px] font-black tracking-widest text-purple-500 uppercase",children:"GUILD OF SHADOWS"})]}),ye=r=>r<=2?20:r===3?18:15,le=({isShaking:r})=>e.jsxs("div",{className:`absolute inset-0 overflow-hidden pointer-events-none z-0 ${r?"animate-shake bg-red-900/20":""}`,children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-full bg-[radial-gradient(ellipse_at_top,var(--tw-gradient-stops))] from-yellow-900/20 via-gray-950 to-black"}),e.jsx("div",{className:"absolute top-0 left-0 w-full h-full opacity-10",children:[...Array(20)].map((i,b)=>{const w=Object.keys(m),v=m[w[b%w.length]].icon;return e.jsx("div",{className:"absolute animate-float text-white/60",style:{left:`${Math.random()*100}%`,top:`${Math.random()*100}%`,animationDuration:`${10+Math.random()*20}s`,transform:`scale(${.5+Math.random()})`},children:e.jsx(v,{size:32})},b)})}),e.jsx("style",{children:`
      @keyframes float {
        0%, 100% { transform: translateY(0) rotate(0deg); }
        50% { transform: translateY(-20px) rotate(10deg); }
      }
      .animate-float { animation: float infinite ease-in-out; }
      
      @keyframes shake {
        0%, 100% { transform: translateX(0); }
        10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
        20%, 40%, 60%, 80% { transform: translateX(5px); }
      }
      .animate-shake { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
    `})]}),ts=({type:r,message:i,subtext:b,icon:w})=>e.jsx("div",{className:"fixed inset-0 z-160 flex items-center justify-center pointer-events-none animate-in fade-in zoom-in duration-300 px-4",children:e.jsxs("div",{className:`
      flex flex-col items-center justify-center p-6 md:p-12 rounded-3xl border-4 shadow-2xl backdrop-blur-xl max-w-lg w-full text-center
      ${r==="success"?"bg-green-950/90 border-green-500 text-green-100":r==="failure"?"bg-red-950/90 border-red-500 text-red-100":"bg-blue-950/90 border-blue-500 text-blue-100"}
    `,children:[w&&e.jsx("div",{className:"mb-4 p-4 bg-black/20 rounded-full",children:e.jsx(w,{size:48,className:"animate-bounce"})}),e.jsx("h2",{className:"text-2xl md:text-4xl font-black uppercase tracking-widest drop-shadow-md mb-2",children:i}),b&&e.jsx("p",{className:"text-sm md:text-lg font-bold opacity-90 tracking-wide",children:b})]})}),ss=({event:r,onClose:i})=>{if(u.useEffect(()=>{if(r){const a=setTimeout(i,4e3);return()=>clearTimeout(a)}},[r,i]),!r)return null;const b=r.type==="SCOUT",w=r.type==="DISCARD",v=r.type==="PLAY",Y=r.cardId?m[r.cardId]:null;return e.jsx("div",{className:"fixed inset-0 z-180 flex items-center justify-center pointer-events-none px-4",children:e.jsxs("div",{className:"bg-gray-900/95 backdrop-blur-xl border-2 border-purple-500/50 shadow-[0_0_50px_rgba(168,85,247,0.4)] rounded-2xl w-full max-w-sm overflow-hidden animate-in zoom-in-95 slide-in-from-bottom-4 duration-300 pointer-events-auto",children:[e.jsxs("div",{className:"bg-linear-to-r from-gray-900 via-purple-900 to-gray-900 p-3 text-center border-b border-purple-500/30",children:[e.jsxs("h3",{className:"font-bold text-lg text-white tracking-widest uppercase flex items-center justify-center gap-2",children:[e.jsx(Ze,{size:18,className:"text-purple-400"}),r.actorName]}),e.jsx("div",{className:"text-[10px] text-purple-200 uppercase tracking-widest opacity-80",children:b?"Scouting Mission":w?"Forced Discard":"Played Action"})]}),e.jsxs("div",{className:"p-6 flex flex-col items-center",children:[e.jsx("div",{className:"mb-6 scale-110",children:v&&Y?e.jsx(Q,{cardId:r.cardId,small:!0,disabled:!0,showCost:!1}):e.jsx("div",{className:"w-20 h-28 bg-gray-800 rounded-xl border-2 border-gray-600 flex items-center justify-center shadow-inner",children:b?e.jsx(ve,{size:32,className:"text-blue-400"}):e.jsx(Z,{size:32,className:"text-red-400"})})}),e.jsxs("div",{className:"w-full space-y-2",children:[r.outcomes.map((a,K)=>e.jsx("div",{className:"bg-black/40 rounded p-2 text-center text-sm border border-gray-700/50 text-gray-200 shadow-sm font-medium",children:a},K)),r.outcomes.length===0&&e.jsx("div",{className:"text-center text-gray-500 text-xs italic",children:"No visible effect."})]})]})]})})},Q=({cardId:r,onClick:i,disabled:b,highlight:w,small:v,tiny:Y,turnsLeft:a,showCost:K=!0})=>{const y=m[r];if(!y)return e.jsx("div",{className:"w-16 h-24 bg-gray-800 rounded"});if(Y)return e.jsxs("div",{className:`relative w-6 h-8 rounded flex items-center justify-center ${y.bg} border ${y.border} shadow-sm`,title:y.name,children:[e.jsx(y.icon,{className:`${y.color} w-3.5 h-3.5`}),a!==void 0&&e.jsx("div",{className:"absolute -top-1.5 -right-1.5 bg-black text-[9px] text-white w-4 h-4 rounded-full flex items-center justify-center border border-gray-500 z-10",children:a})]});const E=v?"w-20 h-28 p-1.5":"w-24 h-40 md:w-32 md:h-48 p-2",M=v?20:28,O=v?"text-[8px]":"text-[9px] md:text-[10px]",I=v?"text-[10px]":"text-[11px] md:text-xs";return e.jsxs("button",{onClick:i,disabled:b,className:`
        relative rounded-xl border-2 shadow-lg transition-all flex flex-col items-center justify-between cursor-pointer active:scale-95 touch-manipulation overflow-visible shrink-0
        ${E} ${y.bg} ${w?"ring-4 ring-yellow-400 z-10 scale-105":y.border}
        ${b?"opacity-50 grayscale cursor-not-allowed":"hover:scale-105 hover:brightness-110"}
      `,children:[e.jsxs("div",{className:"w-full flex justify-between items-center font-bold text-gray-300",children:[e.jsx("span",{className:`${v?"text-[8px]":"text-[10px]"} ${y.type==="AGENT"?"text-blue-300":"text-amber-200"}`,children:y.type==="AGENT"?"AGT":"ACT"}),K&&y.cost>0&&e.jsxs("span",{className:"bg-black/50 px-1.5 rounded text-yellow-400 flex items-center gap-0.5 text-[10px]",children:[y.cost," ",e.jsx(H,{size:8})]})]}),e.jsxs("div",{className:"flex-1 flex items-center justify-center my-1 relative",children:[e.jsx(y.icon,{className:`${y.color}`,size:M}),a!==void 0&&e.jsxs("div",{className:"absolute -bottom-1 -right-1 flex items-center gap-0.5 bg-black/80 px-1.5 py-0.5 rounded-full border border-gray-600 shadow-md",children:[e.jsx(qt,{size:8,className:"text-gray-400"}),e.jsx("span",{className:"text-[10px] text-white font-bold",children:a})]})]}),e.jsxs("div",{className:"w-full text-center",children:[e.jsx("div",{className:`font-bold text-white leading-tight mb-1 line-clamp-1 ${I}`,children:y.name}),e.jsx("div",{className:`
            text-gray-400 leading-tight bg-black/40 rounded flex items-center justify-center px-1 w-full
            ${O} h-auto p-1 whitespace-normal text-center
          `,children:y.desc})]})]})},Xe=({onClose:r})=>e.jsx("div",{className:"fixed inset-0 bg-black/95 z-200 p-4 flex items-center justify-center",children:e.jsxs("div",{className:"bg-gray-900 w-full max-w-2xl max-h-[85vh] flex flex-col rounded-2xl border border-gray-800 overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"p-4 border-b border-gray-800 flex justify-between items-center bg-gray-950",children:[e.jsxs("h2",{className:"font-serif text-xl font-bold text-purple-400 flex items-center gap-2",children:[e.jsx(je,{size:18})," Guild Archives"]}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-gray-800 rounded-full",children:e.jsx(q,{size:20})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 text-sm text-gray-300 space-y-8",children:[e.jsxs("section",{className:"bg-purple-900/10 p-4 rounded-xl border border-purple-500/20",children:[e.jsxs("h3",{className:"font-bold text-xl text-white mb-2 flex items-center gap-2",children:[e.jsx(tt,{size:18,className:"text-yellow-400"})," Victory Condition"]}),e.jsx("p",{children:"Amass enough Gold to buy control of the Guild. The amount required changes based on the number of players:"}),e.jsxs("ul",{className:"list-disc pl-5 mt-2 space-y-1 text-gray-400",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"2 Players:"})," 20 Gold"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"3 Players:"})," 18 Gold"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"4 Players:"})," 15 Gold"]})]})]}),e.jsxs("section",{children:[e.jsxs("h3",{className:"font-bold text-lg text-amber-400 mb-3 border-b border-gray-700 pb-1 flex items-center gap-2",children:[e.jsx(Kt,{size:18})," Actions"," ",e.jsx("span",{className:"text-xs text-gray-500 font-normal ml-auto",children:"(Discarded after use)"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[m.URCHIN,m.THIEF,m.HEIST,m.ASSASSIN,m.BLACKMAIL,m.DOPPELGANGER].map(i=>e.jsxs("div",{className:"bg-gray-800/50 p-2 rounded border border-gray-700 flex items-start gap-2",children:[e.jsx("div",{className:`p-2 rounded bg-black/30 ${i.color}`,children:e.jsx(i.icon,{size:16})}),e.jsxs("div",{children:[e.jsxs("div",{className:`font-bold ${i.color}`,children:[i.name," (Cost ",i.cost,")"]}),e.jsx("div",{className:"text-xs text-gray-400",children:i.desc})]})]},i.id))})]}),e.jsxs("section",{children:[e.jsxs("h3",{className:"font-bold text-lg text-blue-400 mb-3 border-b border-gray-700 pb-1 flex items-center gap-2",children:[e.jsx(Wt,{size:18})," Agents"," ",e.jsx("span",{className:"text-xs text-gray-500 font-normal ml-auto",children:"(Last for 3 Turns)"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[m.MERCHANT,m.LOOKOUT,m.BODYGUARD,m.POLITICIAN,m.SABOTEUR].map(i=>e.jsxs("div",{className:"bg-gray-800/50 p-2 rounded border border-gray-700 flex items-start gap-2",children:[e.jsx("div",{className:`p-2 rounded bg-black/30 ${i.color}`,children:e.jsx(i.icon,{size:16})}),e.jsxs("div",{children:[e.jsxs("div",{className:`font-bold ${i.color}`,children:[i.name," (Cost ",i.cost,")"]}),e.jsx("div",{className:"text-xs text-gray-400",children:i.desc})]})]},i.id))})]}),e.jsxs("section",{className:"bg-gray-800 p-4 rounded-xl border border-gray-700",children:[e.jsx("h3",{className:"font-bold text-white mb-2",children:"Game Mechanics"}),e.jsxs("ul",{className:"list-disc pl-4 space-y-2 text-gray-400",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Scouting:"})," When you Pass, you enter"," ",e.jsx("strong",{children:"Scout Mode"}),". Select a card from your hand to discard, and you will draw a replacement."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Agent Decay:"})," All Agents (Merchants, Bodyguards, etc.) leave your service after ",e.jsx("strong",{children:"3 turns"}),". Plan accordingly."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Taxes & Corruption:"})," Saboteurs tax opponents. Politicians profit from opponent actions."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Pity Bonus:"})," Start your turn with 0 gold? Get +1 extra gold from the guild."]})]})]})]})]})}),as=({report:r})=>r?e.jsxs("div",{className:"w-full bg-green-950/40 border-b border-green-500/30 p-2 flex items-center justify-between animate-in slide-in-from-top-2 duration-300",children:[e.jsxs("div",{className:"flex flex-col gap-0.5 w-full",children:[e.jsx("div",{className:"flex flex-wrap gap-2 text-[10px] text-gray-300",children:r.breakdown.map((i,b)=>e.jsxs("span",{className:"flex gap-1 items-center",children:[e.jsxs("span",{className:"text-gray-400",children:[i.source,":"]}),e.jsxs("span",{className:"text-green-300",children:["+",i.amount]})]},b))}),r.expired.length>0&&e.jsxs("div",{className:"text-[9px] text-red-300 mt-0.5 flex gap-1 items-center",children:[e.jsx(we,{size:8})," Lost:"," ",r.expired.map(i=>m[i]?.name).join(", ")]})]}),e.jsx("div",{className:"pl-3 border-l border-green-500/20 flex flex-col items-center justify-center text-green-400 shrink-0",children:e.jsxs("span",{className:"text-sm font-black",children:["+",r.income]})})]}):null,rs=({report:r})=>r?e.jsxs("div",{className:"w-full bg-indigo-950/40 border-b border-indigo-500/30 p-2 flex items-center justify-between animate-in slide-in-from-top-2 duration-300",children:[e.jsxs("div",{className:"flex flex-col gap-0.5 w-full",children:[e.jsx("div",{className:"text-[10px] text-indigo-300 font-bold uppercase",children:r.actionName}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-[9px] text-gray-400",children:[e.jsxs("span",{children:["Cost: ",r.cost]}),r.tax>0&&e.jsxs("span",{className:"text-red-400",children:["Tax: ",r.tax]}),r.gains.map((i,b)=>e.jsxs("span",{className:"text-green-300",children:[i.desc,": +",i.amount]},b))]})]}),e.jsx("div",{className:"pl-3 border-l border-indigo-500/20 flex flex-col items-center justify-center shrink-0",children:e.jsxs("span",{className:`text-sm font-black ${r.netChange>=0?"text-green-400":"text-red-400"}`,children:[r.netChange>0?"+":"",r.netChange]})})]}):null;function ls(){const[r,i]=u.useState(null),[b,w]=u.useState("menu"),[v,Y]=u.useState(""),[a,K]=u.useState(null),[y,E]=u.useState(""),[M,O]=u.useState(!1),[I,W]=u.useState(localStorage.getItem("guild_room_id")||""),[at,ke]=u.useState(!1),[Se,Ae]=u.useState(!1),[R,B]=u.useState(null),[Ce,De]=u.useState(null),[Te,ee]=u.useState(!1),[ne,Ge]=u.useState(!1),[Ee,U]=u.useState(!1),[j,T]=u.useState(null),[V,oe]=u.useState(null),[te,ie]=u.useState(null),[F,de]=u.useState(null),[rt,Re]=u.useState(null),ze=u.useRef(0),[Oe,$e]=u.useState(null),[Le,Pe]=u.useState(null),[P,lt]=u.useState(()=>localStorage.getItem("gameHub_playerName")||"");u.useEffect(()=>{P&&localStorage.setItem("gameHub_playerName",P)},[P]),u.useEffect(()=>((async()=>typeof __initial_auth_token<"u"&&__initial_auth_token?await Tt(be,__initial_auth_token):await Gt(be))(),Ct(be,i)),[]),u.useEffect(()=>{if(!(!I||!r))return Ue(C(D,"artifacts",G,"public","data","rooms",I),t=>{if(t.exists()){const s=t.data();if(!s.players.some(l=>l.id===r.uid)){W(""),w("menu"),E("You have been removed from the guild.");return}K(s),s.latestPublicEvent&&s.latestPublicEvent.id>ze.current&&(ze.current=s.latestPublicEvent.id,Re(s.latestPublicEvent)),s.status==="playing"&&s.turnReport&&s.turnReport.playerId===r.uid&&!s.turnReport.seen&&($e(s.turnReport),Pe(null)),s.status==="playing"&&s.eveningReport&&s.eveningReport.playerId===r.uid&&!s.eveningReport.seen&&(Pe(s.eveningReport),$e(null)),s.status==="lobby"?w("lobby"):(s.status==="playing"||s.status==="finished")&&w("game")}else W(""),w("menu"),E("The Guild Hall was disbanded by the host.")},t=>console.error(t))},[I,r]),u.useEffect(()=>{const t=Ue(C(D,"game_hub_settings","config"),s=>{s.exists()&&s.data()[Qt]?.maintenance?ke(!0):ke(!1)});return()=>t()},[]);const J=(t,s,n,l)=>{De({type:t,message:s,subtext:n,icon:l}),setTimeout(()=>De(null),2500)},nt=async()=>{if(!P)return E("Enter Alias");O(!0);try{const t="123456789ABCDEFGHIJKLMNPQRSTUVWXYZ";let s="";for(let n=0;n<6;n++)s+=t.charAt(Math.floor(Math.random()*t.length));await Et(C(D,"artifacts",G,"public","data","rooms",s),{roomId:s,hostId:r.uid,status:"lobby",players:[{id:r.uid,name:P,gold:0,hand:[],tableau:[],ready:!1}],deck:[],discardPile:[],turnIndex:0,logs:[],lastAction:null,turnReport:null,eveningReport:null,latestPublicEvent:null}),W(s),localStorage.setItem("guild_room_id",s)}catch(t){console.error(t),E("Failed to create room.")}finally{O(!1)}},ot=async()=>{if(!v||!P)return E("Enter Info");O(!0);try{const t=C(D,"artifacts",G,"public","data","rooms",v),s=await Rt(t);if(!s.exists())return O(!1),E("Invalid Room");const n=s.data();if(n.status!=="lobby")return O(!1),E("Game Started");if(n.players.length>=4)return O(!1),E("Room Full");await L(t,{players:[...n.players,{id:r.uid,name:P,gold:0,hand:[],tableau:[],ready:!1}]}),W(v),localStorage.setItem("guild_room_id",v)}catch(t){console.error(t),E("Failed to join room.")}finally{O(!1)}},it=async t=>{if(a.hostId!==r.uid)return;const s=a.players.filter(n=>n.id!==t);await L(C(D,"artifacts",G,"public","data","rooms",I),{players:s})},He=async()=>{if(a){if(a.hostId===r.uid)await zt(C(D,"artifacts",G,"public","data","rooms",I));else{const t=a.players.filter(s=>s.id!==r.uid);await L(C(D,"artifacts",G,"public","data","rooms",I),{players:t})}W(""),localStorage.removeItem("guild_room_id"),w("menu"),U(!1)}},dt=()=>{const t=a.roomId,s=()=>{Ae(!0),setTimeout(()=>Ae(!1),2e3),J&&J("neutral","COPIED!","",he)};try{navigator.clipboard.writeText(t),s()}catch{const l=document.createElement("textarea");l.value=t,document.body.appendChild(l),l.select(),document.execCommand("copy"),document.body.removeChild(l),s()}},ct=async()=>{if(a.hostId!==r.uid)return;const t=Ve([...es]),s=a.players.map(l=>({...l,hand:[t.pop(),t.pop()],tableau:[],gold:2,ready:!1})),n=Math.floor(Math.random()*s.length);await L(C(D,"artifacts",G,"public","data","rooms",I),{status:"playing",deck:t,players:s,turnIndex:n,totalTurns:0,logs:[{text:"The struggle for the Guild begins...",type:"neutral",id:Date.now()}],lastAction:null,turnReport:null,eveningReport:null,latestPublicEvent:null})},xt=async()=>{const t=a.players.map(s=>s.id===r.uid?{...s,ready:!s.ready}:s);await L(C(D,"artifacts",G,"public","data","rooms",I),{players:t})},Me=async()=>{if(a.hostId!==r.uid)return;const t=a.players.map(s=>({...s,hand:[],tableau:[],gold:0,ready:!1}));await L(C(D,"artifacts",G,"public","data","rooms",I),{status:"lobby",deck:[],discardPile:[],winnerId:null,logs:[],players:t,latestPublicEvent:null}),U(!1)},ce=(t,s)=>{let n=0;return t.forEach(l=>{if(l.id!==s){const g=l.tableau.filter(h=>h.cardId==="SABOTEUR").length;n+=g}}),n},ut=(t,s)=>{t.forEach(n=>{if(n.id!==s){const l=n.tableau.filter(g=>g.cardId==="POLITICIAN").length;l>0&&(n.gold+=l)}})},xe=async(t,s,n,l,g=null,h=null,x=null)=>{let k=(a.turnIndex+1)%t.length,f=t[k];const A=(a.totalTurns||0)+1,N=[],p=[];f.tableau.forEach(z=>{z.turnsLeft-=1,z.turnsLeft<=0?(N.push(z.cardId),n.push(z.cardId)):p.push(z)}),f.tableau=p;let S=0;const _=[];A>=t.length&&(_.push({source:"Guild Stipend",amount:1}),S+=1),f.tableau.forEach(z=>{z.cardId==="MERCHANT"&&(_.push({source:"Silk Trader",amount:1}),S+=1)}),f.gold===0&&(_.push({source:"Pity Bonus",amount:1}),S+=1),f.gold+=S,N.length>0&&l.push({text:`${f.name} lost ${N.length} agents to time.`,type:"warning",id:Date.now()}),l.push({text:`${f.name} begins turn (+${S} Gold).`,type:"neutral",id:Date.now()+1});const ae={playerId:f.id,income:S,breakdown:_,expired:N,seen:!1},ue=ye(t.length);if(f.gold>=ue){const z=t.map(me=>({...me,ready:!1}));await L(C(D,"artifacts",G,"public","data","rooms",I),{players:z,status:"finished",winnerId:f.id,logs:pe({text:`ðŸ† ${f.name} has bought the Guild!`,type:"success",id:Date.now()+2})});return}s.length===0&&(n.length>0?(s=Ve([...n]),n=[],l.push({text:"Deck reshuffled.",type:"warning",id:Date.now()+3})):l.push({text:"Deck empty!",type:"danger",id:Date.now()+3})),s.length>0&&f.hand.push(s.pop()),await L(C(D,"artifacts",G,"public","data","rooms",I),{players:t,deck:s,discardPile:n,turnIndex:k,totalTurns:A,logs:pe(...l),lastAction:g!==null?g:a.lastAction,turnReport:ae,eveningReport:h,latestPublicEvent:x})},mt=async(t,s,n,l,g,h,x,k,f)=>{const c=l[k],A=m[t];let N=[];const p=[];let S=-(A.cost+f);c.gold-=A.cost+f,A.type==="ACTION"&&ut(l,c.id);const _=c.hand.indexOf(t);_>-1&&c.hand.splice(_,1);let ae=a.lastAction;if(A.type==="AGENT")c.tableau.push({cardId:t,turnsLeft:We}),x.push({text:`ðŸ° ${c.name} recruited ${A.name}.`,type:"success",id:Date.now()}),N.push({desc:"Recruited Agent",amount:0}),p.push(`Recruited ${A.name}`),p.push(`Active for ${We} turns`);else if(h.push(t),ae={cardId:t,playerId:c.id},t==="URCHIN")c.gold+=2,S+=2,N.push({desc:"Street Urchin",amount:2}),x.push({text:`ðŸ’° ${c.name} used Urchin (+2 Gold).`,type:"neutral",id:Date.now()}),p.push("Gained +2 Gold from Supply");else if(t==="HEIST")Math.floor(Math.random()*6)+1>=4?(c.gold+=5,S+=5,N.push({desc:"Heist Success",amount:5}),x.push({text:`ðŸŽ² ${c.name} pulled off a Heist! (+5 Gold)`,type:"success",id:Date.now()}),p.push("Heist Successful: +5 Gold!")):(N.push({desc:"Heist Failed",amount:0}),x.push({text:`ðŸŽ² ${c.name}'s Heist failed.`,type:"failure",id:Date.now()}),p.push("Heist Failed: 0 Gold."));else if(t==="THIEF"){const d=l.find(o=>o.id===s);if(d.tableau.some(o=>o.cardId==="BODYGUARD"))N.push({desc:"Thief Blocked",amount:0}),x.push({text:`ðŸ›¡ï¸ ${d.name}'s Bodyguard stopped the Thief!`,type:"warning",id:Date.now()}),p.push(`Targeted ${d.name}`),p.push("Blocked by Bodyguard!");else{const o=Math.min(d.gold,2);d.gold-=o,c.gold+=o,S+=o,N.push({desc:`Stole from ${d.name}`,amount:o}),x.push({text:`ðŸ¦¹ ${c.name} stole ${o} Gold from ${d.name}.`,type:"danger",id:Date.now()}),p.push(`Stole ${o} Gold from ${d.name}`)}}else if(t==="ASSASSIN"){const d=l.find(o=>o.id===s);if(d.tableau.some(o=>o.cardId==="BODYGUARD"))x.push({text:`ðŸ›¡ï¸ ${d.name}'s Bodyguard intercepted!`,type:"warning",id:Date.now()}),p.push(`Targeted ${d.name}`),p.push("Blocked by Bodyguard!");else if(n!==null&&d.tableau[n]){const o=d.tableau[n];d.tableau.splice(n,1),h.push(o.cardId),x.push({text:`ðŸ—¡ï¸ ${c.name} assassinated ${d.name}'s ${m[o.cardId].name}!`,type:"danger",id:Date.now()}),p.push(`Assassinated ${d.name}'s ${m[o.cardId].name}`)}}else if(t==="BLACKMAIL"){const d=l.find(o=>o.id===s);if(d.tableau.some(o=>o.cardId==="BODYGUARD"))x.push({text:`ðŸ›¡ï¸ ${d.name} blocked Blackmail.`,type:"warning",id:Date.now()}),p.push(`Targeted ${d.name}`),p.push("Blocked by Bodyguard!");else if(n==="GOLD"){const o=Math.min(d.gold,4);d.gold-=o,c.gold+=o,S+=o,N.push({desc:"Blackmail Gold",amount:o}),x.push({text:`ðŸ¤ ${c.name} blackmailed ${d.name} for ${o} Gold.`,type:"danger",id:Date.now()}),p.push(`Blackmailed ${d.name} for ${o} Gold`)}else{const o=parseInt(n);if(!isNaN(o)&&d.tableau[o]){const re=d.tableau[o];d.tableau.splice(o,1),c.tableau.push(re),x.push({text:`ðŸ¤ ${c.name} blackmailed ${d.name}'s ${m[re.cardId].name}.`,type:"danger",id:Date.now()}),p.push(`Stole ${d.name}'s ${m[re.cardId].name}`)}}}else if(t==="DOPPELGANGER"){const d=a.lastAction;if(!d||d.cardId==="DOPPELGANGER")x.push({text:`ðŸŽ­ ${c.name}'s Doppelganger fizzled.`,type:"failure",id:Date.now()}),p.push("Effect Fizzled");else{x.push({text:`ðŸŽ­ ${c.name} copies ${m[d.cardId].name}...`,type:"neutral",id:Date.now()});const o=d.cardId;["URCHIN","HEIST"].includes(o)?(o==="URCHIN"&&(c.gold+=2,S+=2,N.push({desc:"Copied Urchin",amount:2}),p.push("Mimicked Urchin: +2 Gold")),o==="HEIST"&&(Math.floor(Math.random()*6)+1>=4?(c.gold+=5,S+=5,N.push({desc:"Copied Heist",amount:5}),p.push("Mimicked Heist: +5 Gold!")):p.push("Mimicked Heist: Failed."))):(c.gold+=3,S+=3,N.push({desc:"Copied Complex Action",amount:3}),x.push({text:"(Doppelganger mimics complex action as +3 Gold)",type:"neutral",id:Date.now()}),p.push(`Mimicked ${m[o].name}`),p.push("Bonus: +3 Gold"))}}const ue=ye(l.length);if(c.gold>=ue){const d=l.map(o=>({...o,ready:!1}));await L(C(D,"artifacts",G,"public","data","rooms",I),{players:d,status:"finished",winnerId:c.id,logs:pe({text:`ðŸ† ${c.name} has bought the Guild!`,type:"success",id:Date.now()+2})});return}const z={playerId:c.id,actionName:A.name,cost:A.cost,tax:f,gains:N,netChange:S,seen:!1},me={id:Date.now(),type:"PLAY",actorName:c.name,cardId:t,outcomes:p};B(null),T(null),oe(null),de(null),await xe(l,g,h,x,ae,z,me)},pt=async t=>{const s=JSON.parse(JSON.stringify(a.players)),n=a.turnIndex,l=s[n],g=[...a.deck],h=[...a.discardPile],x=[],k=l.hand.splice(t,1)[0];h.push(k),x.push({text:`ðŸ—‘ï¸ ${l.name} discarded ${m[k].name} (Hand Limit).`,type:"neutral",id:Date.now()});const f={playerId:l.id,actionName:"Discard",cost:0,tax:0,gains:[],netChange:0,seen:!1},c={id:Date.now(),type:"DISCARD",actorName:l.name,cardId:null,outcomes:[`Discarded ${m[k].name}`,"Hand limit enforced"]};B(null),T(null),await xe(s,g,h,x,null,f,c)},ht=t=>{if(j==="DISCARD"){pt(t);return}if(j==="SCOUT"){jt(t);return}const s=a.players[a.turnIndex].hand[t],n=m[s],l=a.players[a.turnIndex],g=n.type==="ACTION"?ce(a.players,l.id):0;if(l.gold<n.cost+g){J("failure","Insufficient Funds",`Cost: ${n.cost} + ${g} Tax`,H);return}if(s==="DOPPELGANGER"){const h=a.lastAction;let x=null;h&&h.cardId!=="DOPPELGANGER"&&(x=m[h.cardId]),de({handIdx:t,targetCard:x});return}B(t),s==="THIEF"||s==="ASSASSIN"||s==="BLACKMAIL"?T("PLAYER"):(n.type==="AGENT"||s==="URCHIN"||s==="HEIST")&&X(t,null,null)},ft=t=>{if(!j)return;const s=a.players[a.turnIndex].hand[R];s==="THIEF"?X(R,t,null):s==="ASSASSIN"?(oe(t),T("CARD")):s==="BLACKMAIL"&&(oe(t),T("OPTION"))},bt=t=>{j==="CARD"&&V&&X(R,V,t)},gt=t=>{j==="OPTION"&&V&&X(R,V,t)},X=async(t,s,n)=>{const l=JSON.parse(JSON.stringify(a.players)),g=[...a.deck],h=[...a.discardPile],x=[],k=l.find(A=>A.id===r.uid),f=k.hand[t],c=m[f].type==="ACTION"?ce(l,k.id):0;await mt(f,s,n,l,g,h,x,a.turnIndex,c)},yt=()=>{T("SCOUT"),J("success","Scout Mode","Select a card to discard",ve)},jt=async t=>{const s=JSON.parse(JSON.stringify(a.players)),n=a.turnIndex,l=s[n],g=[...a.deck],h=[...a.discardPile],x=[],k=l.hand.splice(t,1)[0];h.push(k),g.length>0&&l.hand.push(g.pop()),x.push({text:`zzz ${l.name} scouted (replaced a card).`,type:"neutral",id:Date.now()});const f={playerId:l.id,actionName:"Scout Mission",cost:0,tax:0,gains:[{desc:"Card Replaced",amount:0}],netChange:0,seen:!1},c={id:Date.now(),type:"SCOUT",actorName:l.name,cardId:null,outcomes:["Discarded 1 card","Drew 1 replacement"]};B(null),T(null),await xe(s,g,h,x,null,f,c)},Nt=()=>{a.deck.length!==0&&(ie(a.deck[a.deck.length-1]),setTimeout(()=>ie(null),3e3))},wt=t=>t==="URCHIN"?"Effect: Gain +2 Gold":t==="HEIST"?"Effect: 50% chance to gain +5 Gold":"Effect: Gain +3 Gold (Mimic Bonus)";if(at)return e.jsxs("div",{className:"min-h-screen bg-gray-950 flex flex-col items-center justify-center text-white p-4 text-center",children:[e.jsx(Je,{}),e.jsxs("div",{className:"bg-orange-500/10 p-8 rounded-2xl border border-orange-500/30",children:[e.jsx(Dt,{size:64,className:"text-orange-500 mx-auto mb-4 animate-bounce"}),e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Under Maintenance"}),e.jsx("p",{className:"text-gray-400",children:"The Guild Hall is dark. The masters are deliberating."})]}),e.jsx("div",{className:"h-8"}),e.jsx("a",{href:"/rawfids-gamehub/",children:e.jsx("div",{className:"flex items-center justify-center gap-3 mb-2",children:e.jsx("div",{className:"text-center pb-12 animate-pulse",children:e.jsxs("div",{className:"inline-flex items-center gap-3 px-8 py-4 bg-slate-900/50 rounded-full border border-indigo-500/20 text-indigo-300 font-bold tracking-widest text-sm uppercase backdrop-blur-sm",children:[e.jsx(Fe,{size:16})," Visit Gamehub...Try our other releases..."," ",e.jsx(Fe,{size:16})]})})})}),e.jsx(ge,{})]});if(!r)return e.jsx("div",{className:"min-h-screen bg-zinc-950 flex items-center justify-center text-purple-500 animate-pulse",children:"Awakenning shadows..."});if(I&&!a&&!y)return e.jsxs("div",{className:"min-h-screen bg-zinc-950 flex flex-col items-center justify-center text-white p-4",children:[e.jsx(le,{}),e.jsxs("div",{className:"bg-zinc-900/80 backdrop-blur p-8 rounded-2xl border border-zinc-700 shadow-2xl flex flex-col items-center gap-4 animate-in fade-in zoom-in duration-300",children:[e.jsx($t,{size:48,className:"text-purple-500 animate-spin"}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Reconnecting..."}),e.jsx("p",{className:"text-zinc-400 text-sm",children:"Resuming your session"})]})]})]});if(b==="menu")return e.jsxs("div",{className:"min-h-screen bg-gray-950 text-white flex flex-col items-center justify-center p-4 relative overflow-hidden font-sans",children:[e.jsx(le,{}),e.jsx("nav",{className:"absolute top-0 left-0 w-full p-4 z-50",children:e.jsxs("a",{href:"/rawfids-gamehub/",className:"flex items-center gap-2 text-purple-800 rounded-lg font-bold shadow-md hover:text-purple-400 transition-colors w-fit animate-pulse",children:[e.jsx(Lt,{}),e.jsx("span",{children:"Back to Gamehub"})]})}),e.jsxs("div",{className:"z-10 text-center mb-10",children:[e.jsx(Ie,{size:64,className:"text-purple-500 mx-auto mb-4 animate-bounce drop-shadow-lg"}),e.jsx("h1",{className:"text-5xl md:text-6xl font-black text-transparent bg-clip-text bg-linear-to-b from-purple-400 to-indigo-600 font-serif tracking-widest",children:"GUILD OF SHADOWS"}),e.jsx("p",{className:"text-white-400/60 tracking-[0.3em] uppercase mt-2",children:"In Shadows We Trust"})]}),e.jsxs("div",{className:"bg-gray-900/80 backdrop-blur border border-purple-500/30 p-6 rounded-2xl w-full max-w-sm shadow-2xl z-10",children:[y&&e.jsx("div",{className:"bg-red-900/50 text-red-200 p-2 mb-4 rounded text-center text-xs border border-red-800",children:y}),e.jsx("input",{className:"w-full bg-black/50 border border-gray-700 p-3 rounded mb-3 text-white placeholder-gray-500 focus:border-purple-500 outline-none transition-colors",placeholder:"CODENAME",value:P,onChange:t=>lt(t.target.value)}),e.jsxs("button",{onClick:nt,disabled:M,className:"w-full bg-linear-to-r from-purple-700 to-indigo-600 hover:from-purple-600 p-3 rounded font-bold mb-3 flex items-center justify-center gap-2 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",children:[M?e.jsx(Ye,{size:18,className:"animate-spin"}):e.jsx(fe,{size:18}),M?"Establishing...":"Establish Guild"]}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{className:"flex-1 bg-black/50 border border-gray-700 p-3 rounded text-white placeholder-gray-500 uppercase font-mono tracking-wider focus:border-purple-500 outline-none",placeholder:"CODE",value:v,onChange:t=>Y(t.target.value.toUpperCase())}),e.jsx("button",{onClick:ot,disabled:M,className:"bg-gray-800 hover:bg-gray-700 border border-gray-600 px-4 rounded font-bold disabled:opacity-50 disabled:cursor-not-allowed min-w-[80px] flex items-center justify-center",children:M?e.jsx(Ye,{size:16,className:"animate-spin"}):"Join"})]}),e.jsxs("button",{onClick:()=>ee(!0),className:"w-full text-xs text-gray-500 hover:text-white flex items-center justify-center gap-2 py-2",children:[e.jsx(je,{size:14})," Guild Archives"]})]}),Te&&e.jsx(Xe,{onClose:()=>ee(!1)}),e.jsxs("div",{className:"absolute bottom-4 text-slate-600 text-xs text-center",children:["Developed by ",e.jsx("strong",{children:"RAWFID K SHUVO"}),". Visit"," ",e.jsx("a",{href:"/rawfids-gamehub/",rel:"noopener noreferrer",className:"text-purple-500 underline hover:text-purple-600",children:"GAMEHUB"})," ","for more games."]})]});if(b==="lobby"&&a){const t=a.hostId===r.uid;return e.jsxs("div",{className:"min-h-screen bg-gray-950 text-white flex flex-col items-center justify-center p-4 relative",children:[e.jsx(le,{}),e.jsx(Je,{}),e.jsxs("div",{className:"z-10 w-full max-w-md bg-gray-900/90 backdrop-blur p-6 rounded-2xl border border-purple-900/50 shadow-2xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 border-b border-gray-800 pb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg md:text-xl text-purple-400 font-bold uppercase",children:"Shadow Hall"}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsx("div",{className:"text-2xl md:text-3xl font-mono text-white font-black",children:a.roomId}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:dt,className:"p-2 hover:bg-white/10 rounded-full transition-colors text-gray-400 hover:text-white",children:Se?e.jsx(he,{size:16,className:"text-green-500"}):e.jsx(Ne,{size:16})}),Se&&e.jsx("div",{className:"absolute left-full ml-2 top-1/2 -translate-y-1/2 bg-purple-500 text-black text-xs font-bold px-2 py-1 rounded shadow-lg animate-fade-in-up whitespace-nowrap",children:"Copied!"})]})]})]}),e.jsx("button",{onClick:()=>U(!0),className:"text-red-400 hover:text-red-300",children:e.jsx(we,{size:20})})]}),e.jsxs("div",{className:"space-y-2 mb-6",children:[e.jsx("h3",{className:"text-xs uppercase text-gray-500 font-bold tracking-wider",children:"Operatives"}),a.players.map(s=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-800/50 p-3 rounded border border-gray-700/50 group",children:[e.jsxs("span",{className:"font-bold flex items-center gap-2",children:[e.jsx(Ze,{size:14})," ",s.name,s.id===a.hostId&&e.jsx(fe,{size:14,className:"text-yellow-500"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-green-500 text-xs flex items-center gap-1",children:[e.jsx(he,{size:12})," Ready"]}),t&&s.id!==r.uid&&e.jsx("button",{onClick:()=>it(s.id),className:"text-gray-600 hover:text-red-500 transition-colors p-1",title:"Kick Player",children:e.jsx(Z,{size:14})})]})]},s.id))]}),t?e.jsx("button",{onClick:ct,disabled:a.players.length<2,className:`w-full py-3 rounded-xl font-bold text-lg shadow-lg flex items-center justify-center gap-2 ${a.players.length<2?"bg-gray-800 text-gray-500 cursor-not-allowed":"bg-green-700 hover:bg-green-600 text-white"}`,children:"Start Operation"}):e.jsx("div",{className:"text-center text-purple-400/60 animate-pulse text-sm",children:"Waiting for Guild Master..."})]}),Ee&&e.jsx("div",{className:"fixed inset-0 z-200 bg-black/90 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-gray-800 p-6 rounded-2xl w-full max-w-sm text-center border border-gray-700 shadow-2xl",children:[e.jsx("h3",{className:"text-lg font-bold mb-4 text-white",children:"Abandon the Guild?"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("button",{onClick:()=>U(!1),className:"bg-gray-700 hover:bg-gray-600 py-3 rounded font-bold transition-colors",children:"Cancel"}),e.jsx("button",{onClick:He,className:"bg-red-600 hover:bg-red-500 py-3 rounded font-bold transition-colors",children:a.hostId===r.uid?"Disband Guild (Delete Room)":"Leave Game"})]})]})}),e.jsx(ge,{})]})}const _e=a.players.findIndex(t=>t.id===r.uid),$=a.players[_e],se=a.turnIndex===_e;R!==null&&m[$.hand[R]];const Be=ce(a.players,$.id),vt=ye(a.players.length),It=$.tableau.some(t=>t.cardId==="LOOKOUT");return e.jsxs("div",{className:"h-dvh bg-gray-950 text-white overflow-hidden flex flex-col relative font-sans",children:[e.jsx(le,{}),Ce&&e.jsx(ts,{...Ce}),e.jsx(ss,{event:rt,onClose:()=>Re(null)}),te&&e.jsx("div",{className:"fixed inset-0 z-200 flex items-center justify-center bg-black/80 backdrop-blur",onClick:()=>ie(null),children:e.jsxs("div",{className:"animate-in zoom-in duration-200 flex flex-col items-center p-8",children:[e.jsx("div",{className:"text-white font-bold mb-6 text-2xl tracking-widest",children:"Top of Deck"}),e.jsx("div",{className:"scale-150 transform transition-all",children:e.jsx(Q,{cardId:te})}),e.jsx("div",{className:"mt-8 text-gray-400 text-sm animate-pulse",children:"(Tap anywhere to close)"})]})}),F&&e.jsx("div",{className:"fixed inset-0 z-190 bg-black/90 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-gray-800 border-2 border-cyan-500 rounded-2xl w-full max-w-sm flex flex-col items-center p-6 shadow-[0_0_30px_rgba(34,211,238,0.2)] animate-in zoom-in-95",children:[e.jsx(Ne,{size:48,className:"text-cyan-400 mb-4"}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:"Doppelganger"}),e.jsxs("div",{className:"text-center mb-6 w-full",children:[e.jsx("p",{className:"text-gray-400 text-sm mb-2",children:"Copying previous action:"}),F.targetCard?e.jsxs("div",{className:"bg-black/40 p-4 rounded-lg border border-gray-700 flex flex-col items-center w-full",children:[e.jsx("span",{className:`font-bold ${F.targetCard.color} text-lg`,children:F.targetCard.name}),e.jsx("div",{className:"mt-3 bg-cyan-900/30 text-cyan-200 px-3 py-2 rounded text-sm font-bold border border-cyan-500/30 w-full text-center",children:wt(F.targetCard.id)})]}):e.jsx("div",{className:"bg-red-900/20 border border-red-500/50 p-3 rounded text-red-200 text-sm italic",children:"No valid action to copy (Effect will fizzle)."})]}),e.jsxs("div",{className:"flex gap-3 w-full",children:[e.jsx("button",{onClick:()=>de(null),className:"flex-1 bg-gray-700 hover:bg-gray-600 py-3 rounded-xl font-bold transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>X(F.handIdx,null,null),className:"flex-1 bg-cyan-600 hover:bg-cyan-500 py-3 rounded-xl font-bold text-white shadow-lg transition-transform active:scale-95",children:"Proceed"})]})]})}),e.jsxs("div",{className:"h-14 bg-gray-900/90 border-b border-gray-800 flex items-center justify-between px-4 z-160 shrink-0 shadow-md",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-serif text-purple-500 font-bold hidden md:inline text-lg",children:"GUILD OF SHADOWS"}),e.jsxs("span",{className:"bg-purple-900/40 text-yellow-500 text-xs px-3 py-1 rounded-full border border-purple-800/50 font-mono tracking-wider shadow-[0_0_10px_rgba(168,85,247,0.2)]",children:["Goal: ",vt," ",e.jsx(H,{size:10,className:"inline ml-0.5"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>Ge(!ne),className:`p-2 rounded-full ${ne?"bg-purple-900 text-purple-400":"text-gray-400 hover:bg-gray-800"}`,children:e.jsx(Yt,{size:20})}),e.jsx("button",{onClick:()=>ee(!0),className:"p-2 text-gray-400 hover:bg-gray-800 rounded-full transition-colors",children:e.jsx(je,{size:20})}),e.jsx("button",{onClick:()=>U(!0),className:"p-2 text-red-400 hover:bg-red-900/20 rounded-full transition-colors",children:e.jsx(we,{size:20})})]})]}),e.jsxs("div",{className:"flex-1 relative overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 pb-4",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:a.players.map((t,s)=>{if(t.id===r.uid)return null;const n=a.turnIndex===s,l=j==="PLAYER",g=V===t.id;return e.jsxs("div",{onClick:()=>l?ft(t.id):null,className:`
                        relative bg-gray-900/80 backdrop-blur-sm p-3 rounded-xl border transition-all duration-200
                        ${n?"border-purple-500 shadow-[0_0_20px_rgba(168,85,247,0.25)] bg-purple-900/10 scale-[1.02]":"border-gray-800"}
                        ${l?"cursor-pointer hover:border-red-400 hover:bg-red-900/10 ring-2 ring-transparent hover:ring-red-500/50":""}
                        ${g?"ring-2 ring-red-500 bg-red-900/20":""}
                      `,children:[n&&e.jsxs("div",{className:"absolute -top-2 left-1/2 -translate-x-1/2 bg-purple-600 text-purple-100 text-[9px] px-2 py-0.5 rounded-full font-bold shadow-lg animate-pulse z-10 whitespace-nowrap flex items-center gap-1",children:[e.jsx(Ke,{size:8})," PLAYING"]}),e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-sm font-bold text-gray-200 flex items-center gap-1.5 truncate max-w-[100px]",children:[t.name,t.id===a.hostId&&e.jsx(fe,{size:12,className:"text-yellow-500"})]}),e.jsxs("span",{className:"text-xs text-yellow-500 flex items-center gap-1 font-mono bg-black/40 px-1.5 py-0.5 rounded w-fit mt-1 border border-yellow-500/20",children:[t.gold," ",e.jsx(H,{size:10})]})]}),e.jsx("div",{className:"flex gap-0.5",children:t.hand.map((h,x)=>e.jsx("div",{className:"w-2.5 h-4 bg-linear-to-b from-purple-800 to-purple-950 rounded-[2px] border border-purple-600/50 shadow-sm"},x))})]}),e.jsxs("div",{className:"flex flex-wrap gap-1.5 min-h-[32px]",children:[t.tableau.map((h,x)=>e.jsx("div",{onClick:k=>{k.stopPropagation(),bt(x)},className:`${j==="CARD"&&g?"animate-pulse cursor-pointer ring-1 ring-red-400 rounded":""}`,children:e.jsx(Q,{cardId:h.cardId,turnsLeft:h.turnsLeft,tiny:!0})},x)),t.tableau.length===0&&e.jsx("div",{className:"w-full h-8 flex items-center justify-center text-[10px] text-gray-600 italic border border-dashed border-gray-800 rounded",children:"Empty Hall"})]})]},t.id)})}),e.jsx("div",{className:"mt-6 flex flex-col items-center space-y-1.5 pointer-events-none opacity-80",children:a.logs.slice(-3).reverse().map(t=>e.jsx("div",{className:`text-[10px] px-3 py-1 rounded-full backdrop-blur-md shadow-lg border ${t.type==="danger"?"bg-red-950/70 border-red-500/30 text-red-200":"bg-gray-900/70 border-gray-700/50 text-gray-300"}`,children:t.text},t.id))})]}),e.jsxs("div",{className:"bg-gray-950 border-t border-purple-900/30 pb-safe z-40 shadow-[0_-10px_40px_rgba(0,0,0,0.8)] flex flex-col shrink-0",children:[e.jsxs("div",{className:"w-full bg-black/20",children:[se&&e.jsx("div",{className:"w-full bg-green-600/20 border-y border-green-500/30 py-1 flex items-center justify-center animate-pulse",children:e.jsxs("span",{className:"text-green-400 font-bold tracking-[0.3em] text-[10px] md:text-xs uppercase flex items-center gap-2",children:[e.jsx(Ke,{size:10})," Your Turn"]})}),!te&&Oe?e.jsx(as,{report:Oe}):!te&&Le?e.jsx(rs,{report:Le}):null]}),e.jsxs("div",{className:"flex justify-between items-center px-4 py-2 bg-gray-900 border-b border-gray-800",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-yellow-400 font-black text-2xl flex items-center gap-2 drop-shadow-md",children:[e.jsx(H,{className:"fill-yellow-400/20",size:24})," ",$.gold]}),Be>0&&e.jsxs("div",{className:"text-xs text-red-400 flex items-center gap-1 bg-red-950/50 px-2 py-1 rounded border border-red-900/50",children:["Tax: +",Be," ",e.jsx(H,{size:10})]})]}),e.jsx("div",{className:"flex gap-1.5 overflow-x-auto max-w-[50%] no-scrollbar items-center mask-linear-fade",children:$.tableau.map((t,s)=>e.jsx("div",{className:"shrink-0",children:e.jsx(Q,{cardId:t.cardId,turnsLeft:t.turnsLeft,tiny:!0})},s))})]}),e.jsxs("div",{className:"min-h-[50px] flex items-center justify-center py-2 px-4",children:[se&&!j&&R===null&&e.jsxs("div",{className:"flex gap-3 w-full justify-center",children:[It&&e.jsxs("button",{onClick:Nt,className:"bg-indigo-900 hover:bg-indigo-800 text-indigo-200 border border-indigo-500/50 px-5 py-2.5 rounded-xl font-bold shadow-lg flex items-center gap-2 text-sm transition-all active:scale-95",children:[e.jsx(et,{size:16})," Peek"]}),$.hand.length>5?e.jsxs("button",{onClick:()=>{T("DISCARD"),J("neutral","Discard Mode","Hand limit reached",Z)},className:"flex-1 max-w-xs bg-red-900/90 hover:bg-red-800 text-red-100 border border-red-500/50 px-6 py-2.5 rounded-xl font-bold shadow-lg flex items-center justify-center gap-2 text-sm transition-all active:scale-95",children:["Discard & Pass ",e.jsx(Z,{size:16})]}):e.jsxs("button",{onClick:yt,className:"flex-1 max-w-xs bg-gray-800 hover:bg-gray-700 text-gray-200 border border-gray-600 px-6 py-2.5 rounded-xl font-bold shadow-lg flex items-center justify-center gap-2 text-sm transition-all active:scale-95",children:["Pass & Scout ",e.jsx(Jt,{size:16})]})]}),j==="SCOUT"&&e.jsxs("div",{className:"flex items-center gap-3 bg-blue-900/30 border border-blue-500/30 px-4 py-2 rounded-full",children:[e.jsxs("span",{className:"text-blue-300 text-sm font-bold flex items-center gap-2",children:[e.jsx(ve,{size:16})," Select card to discard"]}),e.jsx("button",{onClick:()=>T(null),className:"bg-gray-800 p-1 rounded-full",children:e.jsx(q,{size:12})})]}),j==="DISCARD"&&e.jsxs("div",{className:"flex items-center gap-3 bg-red-900/30 border border-red-500/30 px-4 py-2 rounded-full",children:[e.jsxs("span",{className:"text-red-300 text-sm font-bold flex items-center gap-2",children:[e.jsx(Z,{size:16})," Hand Full: Discard 1"]}),e.jsx("button",{onClick:()=>T(null),className:"bg-gray-800 p-1 rounded-full",children:e.jsx(q,{size:12})})]}),j==="PLAYER"&&e.jsxs("div",{className:"flex items-center gap-3 bg-red-900/30 border border-red-500/30 px-4 py-2 rounded-full animate-pulse",children:[e.jsxs("span",{className:"text-red-300 text-sm font-bold flex items-center gap-2",children:[e.jsx(Qe,{size:16})," Select Target Player"]}),e.jsx("button",{onClick:()=>{T(null),B(null)},className:"bg-gray-800 p-1 rounded-full",children:e.jsx(q,{size:12})})]}),R!==null&&!j&&e.jsx("button",{onClick:()=>B(null),className:"bg-gray-800 text-gray-400 px-4 py-1.5 rounded-full text-xs font-bold border border-gray-700",children:"Cancel Selection"}),j==="CARD"&&e.jsx("div",{className:"bg-black/60 px-4 py-2 rounded-full text-sm font-bold border border-red-500/50 text-red-200",children:"Select Agent to Destroy"}),j==="OPTION"&&e.jsxs("div",{className:"flex gap-3 w-full justify-center",children:[e.jsx("button",{onClick:()=>gt("GOLD"),className:"bg-yellow-700 hover:bg-yellow-600 text-white px-5 py-2 rounded-xl font-bold shadow-lg flex items-center gap-2 border border-yellow-500",children:"Steal 4 Gold"}),e.jsx("button",{onClick:()=>T("CARD"),className:"bg-blue-700 hover:bg-blue-600 text-white px-5 py-2 rounded-xl font-bold shadow-lg flex items-center gap-2 border border-blue-500",children:"Steal Agent"})]})]}),e.jsxs("div",{className:"flex overflow-x-auto px-4 pb-4 gap-3 no-scrollbar snap-x snap-mandatory min-h-[180px] items-center",children:[$.hand.length===0&&e.jsx("div",{className:"text-gray-600 text-sm italic w-full text-center py-8 border-2 border-dashed border-gray-800 rounded-xl",children:"Hand Empty"}),$.hand.map((t,s)=>e.jsx("div",{className:`snap-center transition-transform duration-200 ${R===s?"-translate-y-6 scale-105":""}`,children:e.jsx(Q,{cardId:t,onClick:()=>se?ht(s):null,disabled:!se||j!==null&&j!=="SCOUT"&&j!=="DISCARD"&&R!==s,highlight:R===s})},s)),e.jsx("div",{className:"w-2 shrink-0"})]})]})]}),ne&&e.jsxs("div",{className:"fixed top-16 right-4 w-64 max-h-60 bg-gray-900/95 border border-gray-700 rounded-xl z-155 overflow-y-auto p-2 shadow-2xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Shadow Log"}),e.jsx("button",{onClick:()=>Ge(!1),children:e.jsx(q,{})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto space-y-2",children:[...a.logs].reverse().map(t=>e.jsxs("div",{className:`p-3 rounded border-l-4 text-sm ${t.type==="danger"?"bg-red-900/20 border-red-500":t.type==="success"?"bg-green-900/20 border-green-500":"bg-gray-800 border-gray-600"}`,children:[e.jsx("span",{className:"opacity-70 text-[10px] block mb-1",children:new Date(t.id).toLocaleTimeString()}),t.text]},t.id))})]}),Ee&&e.jsx("div",{className:"fixed inset-0 z-200 bg-black/90 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-gray-800 p-6 rounded-2xl w-full max-w-sm text-center",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Abandon the Guild?"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("button",{onClick:()=>U(!1),className:"bg-gray-700 py-3 rounded font-bold",children:"Cancel"}),a.hostId===r.uid&&e.jsx("button",{onClick:Me,className:"bg-purple-700 py-3 rounded font-bold",children:"Return to Lobby"}),e.jsx("button",{onClick:He,className:"bg-red-600 py-3 rounded font-bold",children:a.hostId===r.uid?"Leave (Delete Room)":"Leave Game"})]})]})}),a.status==="finished"&&e.jsxs("div",{className:"fixed inset-0 top-14 z-150 bg-black/90 flex flex-col items-center justify-center p-6 text-center animate-in fade-in",children:[e.jsx(tt,{size:80,className:"text-yellow-400 mb-6 animate-bounce"}),e.jsx("h2",{className:"text-4xl font-black text-white mb-2",children:"GAME OVER"}),e.jsxs("p",{className:"text-2xl text-purple-400 font-serif mb-8",children:[a.players.find(t=>t.id===a.winnerId)?.name," ","is the new Guild Master!"]}),e.jsxs("div",{className:"bg-gray-800/80 p-5 rounded-2xl mb-6 w-full max-w-sm border border-gray-700 shadow-xl",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-400 uppercase tracking-widest mb-4 border-b border-gray-700 pb-2",children:"Final Standings"}),e.jsx("div",{className:"space-y-3",children:[...a.players].sort((t,s)=>s.gold-t.gold).map((t,s)=>e.jsxs("div",{className:"flex justify-between items-center bg-black/30 p-2 rounded",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`
                            w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold
                            ${s===0?"bg-yellow-500 text-black":"bg-gray-700 text-gray-300"}
                         `,children:s+1}),e.jsx("span",{className:`font-bold ${t.id===a.winnerId?"text-yellow-400":"text-white"}`,children:t.name})]}),e.jsxs("div",{className:"font-mono text-yellow-500 font-bold flex items-center gap-1",children:[t.gold," ",e.jsx(H,{size:12})]})]},t.id))})]}),e.jsxs("div",{className:"bg-gray-800/50 p-4 rounded-xl mb-6 w-full max-w-sm",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-400 mb-2 uppercase tracking-widest",children:"Rematch Status"}),e.jsx("div",{className:"space-y-2",children:a.players.map(t=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:t.name}),e.jsx("span",{className:t.ready?"text-green-400 font-bold":"text-gray-500",children:t.ready?"READY":"WAITING"})]},t.id))})]}),e.jsxs("div",{className:"flex flex-col gap-3 w-full max-w-xs",children:[$.ready?e.jsx("div",{className:"text-green-500 font-bold mb-2",children:"You are ready!"}):e.jsx("button",{onClick:xt,className:"bg-green-600 hover:bg-green-500 text-white py-3 rounded-lg font-bold",children:"Ready for Rematch"}),a.hostId===r.uid&&e.jsx("button",{onClick:Me,disabled:!a.players.every(t=>t.ready),className:`py-3 rounded-lg font-bold transition-all ${a.players.every(t=>t.ready)?"bg-white text-black hover:scale-105":"bg-gray-700 text-gray-500 cursor-not-allowed"}`,children:"Return to Lobby"})]})]}),e.jsx(ge,{}),Te&&e.jsx(Xe,{onClose:()=>ee(!1)})]})}Ot.createRoot(document.getElementById("root")).render(e.jsx(u.StrictMode,{children:e.jsx(ls,{})}));
