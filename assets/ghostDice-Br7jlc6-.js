import{c as O,i as qe,g as Fe,a as Pe,r as o,e as Ve,o as pe,d as h,j as e,H as We,S as ye,R as V,n as Ue,s as Ye,h as Ke,p as Xe,u as C,q as W,t as Qe,v as Je,X as ke,m as Ze}from"./x-vdu6PxPT.js";import{L as et,S as tt,B as ae,C as A,a as st,b as ie}from"./step-back-DgPuYW0s.js";import{D as H,M as at}from"./megaphone-CtFoEeL1.js";import{C as je}from"./crown-DhFWzZA3.js";import{U as we}from"./user-hi-jrCL7.js";import{T as it}from"./trash-2-CC3Hg-Aa.js";import{H as Ie}from"./history-r3RmdCN7.js";import{D as nt}from"./dice-5-kys5QpJR.js";import{S as rt}from"./skull--JE29QMg.js";import{G as lt}from"./ghost-Ddz50Svz.js";import{R as Ce}from"./rotate-ccw-B8nxxfV1.js";import{H as Se}from"./house-BdFnrmDF.js";import{G as ot}from"./gavel-CJ-N0LgK.js";import{T as dt}from"./trophy-CV5zFLFQ.js";const ct=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M12 12h.01",key:"1mp3jc"}]],xt=O("dice-1",ct);const mt=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M15 9h.01",key:"x1ddxp"}],["path",{d:"M9 15h.01",key:"fzyn71"}]],ut=O("dice-2",mt);const ht=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M16 8h.01",key:"cr5u4v"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],bt=O("dice-3",ht);const gt=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M16 8h.01",key:"cr5u4v"}],["path",{d:"M8 8h.01",key:"1e4136"}],["path",{d:"M8 16h.01",key:"18s6g9"}],["path",{d:"M16 16h.01",key:"1f9h7w"}]],ft=O("dice-4",gt);const pt=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M16 8h.01",key:"cr5u4v"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M16 16h.01",key:"1f9h7w"}],["path",{d:"M8 8h.01",key:"1e4136"}],["path",{d:"M8 12h.01",key:"czm47f"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],yt=O("dice-6",pt),jt={apiKey:"AIzaSyBjIjK53vVJW1y5RaqEFGSFp0ECVDBEe1o",authDomain:"game-hub-ff8aa.firebaseapp.com",projectId:"game-hub-ff8aa",storageBucket:"game-hub-ff8aa.firebasestorage.app",messagingSenderId:"586559578902",appId:"1:586559578902:web:91da4fa4ace038d16aa637"},_e=qe(jt),te=Fe(_e),m=Pe(_e),y=typeof __app_id<"u"?__app_id:"ghost-dice",wt="7",$="ghost_dice_roomId",_={1:xt,2:ut,3:bt,4:ft,5:nt,6:yt},B=[{name:"Green",color:"text-green-400",border:"border-green-500",bg:"bg-green-900/20",shadow:"shadow-green-500/20",ring:"ring-green-500"},{name:"Orange",color:"text-orange-400",border:"border-orange-500",bg:"bg-orange-900/20",shadow:"shadow-orange-500/20",ring:"ring-orange-500"},{name:"Cyan",color:"text-cyan-400",border:"border-cyan-500",bg:"bg-cyan-900/20",shadow:"shadow-cyan-500/20",ring:"ring-cyan-500"},{name:"Yellow",color:"text-yellow-400",border:"border-yellow-500",bg:"bg-yellow-900/20",shadow:"shadow-yellow-500/20",ring:"ring-yellow-500"},{name:"Purple",color:"text-purple-400",border:"border-purple-500",bg:"bg-purple-900/20",shadow:"shadow-purple-500/20",ring:"ring-purple-500"},{name:"Rose",color:"text-rose-400",border:"border-rose-500",bg:"bg-rose-900/20",shadow:"shadow-rose-500/20",ring:"ring-rose-500"}],U=({isShaking:n})=>e.jsxs("div",{className:`absolute inset-0 overflow-hidden pointer-events-none z-0 ${n?"animate-shake bg-red-900/20":""}`,children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-full bg-[radial-gradient(ellipse_at_top,var(--tw-gradient-stops))] from-slate-900/40 via-gray-950 to-black"}),e.jsx("div",{className:"absolute top-0 left-0 w-full h-full opacity-10",children:[...Array(20)].map((b,c)=>{const x=Object.keys(_),l=x[c%x.length],g=_[l];return e.jsx("div",{className:"absolute animate-float text-white/60",style:{left:`${Math.random()*100}%`,top:`${Math.random()*100}%`,animationDuration:`${10+Math.random()*20}s`,transform:`scale(${.5+Math.random()})`},children:e.jsx(g,{size:32})},c)})}),e.jsx("style",{children:`
      @keyframes float {
        0%, 100% { transform: translateY(0) rotate(0deg); }
        50% { transform: translateY(-20px) rotate(10deg); }
      }
      .animate-float { animation: float infinite ease-in-out; }
      
      @keyframes shake {
        0%, 100% { transform: translateX(0); }
        10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
        20%, 40%, 60%, 80% { transform: translateX(5px); }
      }
      .animate-shake { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
    `})]}),se=()=>e.jsxs("div",{className:"flex items-center justify-center gap-1 opacity-40 mt-auto pb-2 pt-2 relative z-10",children:[e.jsx(H,{size:12,className:"text-indigo-400"}),e.jsx("span",{className:"text-[10px] font-black tracking-widest text-indigo-400 uppercase",children:"GHOST DICE"})]}),Ne=()=>e.jsxs("div",{className:"flex items-center justify-center gap-1 opacity-40 mt-auto pb-2 pt-2 relative z-10",children:[e.jsx(H,{size:22,className:"text-indigo-400"}),e.jsx("span",{className:"text-[20px] font-black tracking-widest text-indigo-400 uppercase",children:"GHOST DICE"})]}),ve=({onConfirmLeave:n,onConfirmLobby:b,onCancel:c,isHost:x,inGame:l})=>e.jsx("div",{className:"fixed inset-0 bg-black/90 z-200 flex items-center justify-center p-4 animate-in fade-in",children:e.jsxs("div",{className:"bg-zinc-900 rounded-xl border border-zinc-700 p-6 max-w-sm w-full text-center shadow-2xl",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Abandon the Haunt?"}),e.jsx("p",{className:"text-zinc-400 mb-6 text-sm",children:l?"Leaving now will forfeit your soul (and the game).":"Leaving the lobby will disconnect you."}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("button",{onClick:c,className:"bg-zinc-700 hover:bg-zinc-600 text-white py-3 rounded font-bold transition-colors",children:"Stay"}),l&&x&&e.jsxs("button",{onClick:b,className:"py-3 rounded font-bold transition-colors flex items-center justify-center gap-2 bg-indigo-600 hover:bg-indigo-500 text-white",children:[e.jsx(Se,{size:18})," Return Group to Lobby"]}),e.jsxs("button",{onClick:n,className:"bg-red-900/80 hover:bg-red-800 text-red-200 py-3 rounded font-bold transition-colors flex items-center justify-center gap-2 border border-red-900",children:[e.jsx(ie,{size:18})," Leave Game"]})]})]})}),Nt=({logs:n,onClose:b})=>e.jsx("div",{className:"fixed top-16 right-4 w-64 max-h-60 bg-gray-900/95 border border-gray-700 rounded-xl z-155 overflow-y-auto p-2 shadow-2xl",children:e.jsxs("div",{className:"bg-zinc-900 w-full md:max-w-md h-full md:h-[70vh] rounded-none md:rounded-xl flex flex-col border-none md:border border-zinc-700 shadow-2xl",children:[e.jsxs("div",{className:"p-4 border-b border-zinc-800 flex justify-between items-center bg-zinc-950",children:[e.jsxs("h3",{className:"text-white font-bold text-lg flex items-center gap-2",children:[e.jsx(Ie,{size:18,className:"text-indigo-400"})," Séance Logs"]}),e.jsx("button",{onClick:b,className:"p-2 bg-zinc-800 rounded-full hover:bg-zinc-700",children:e.jsx(ke,{className:"text-zinc-400"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2",children:[...n].reverse().map((c,x)=>e.jsxs("div",{className:`text-xs md:text-sm p-3 rounded border-l-2 ${c.type==="danger"?"bg-red-900/10 border-red-500 text-red-300":c.type==="success"?"bg-green-900/10 border-green-500 text-green-300":c.type==="warning"?"bg-indigo-900/10 border-indigo-500 text-indigo-300":"bg-zinc-800/50 border-zinc-600 text-zinc-400"}`,children:[e.jsxs("span",{className:"opacity-50 mr-2 font-mono",children:["[",new Date(parseInt(c.id)).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"}),"]"]}),c.text]},x))})]})}),ze=({onClose:n})=>e.jsx("div",{className:"fixed inset-0 bg-black/95 z-100 flex items-center justify-center p-0 md:p-4 animate-in fade-in",children:e.jsxs("div",{className:"bg-zinc-900 md:rounded-2xl w-full max-w-4xl h-full md:h-auto md:max-h-[90vh] overflow-hidden border-none md:border border-indigo-500/30 flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-zinc-800 flex justify-between items-center bg-zinc-950",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-2 tracking-wider",children:[e.jsx(ae,{className:"text-indigo-400"})," The Grimoire"]}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-zinc-800 rounded-full text-zinc-400",children:e.jsx(ke,{})})]}),e.jsx("div",{className:"p-6 overflow-y-auto text-zinc-300 space-y-6",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-zinc-800/50 p-4 rounded-lg border border-zinc-700",children:[e.jsx("h3",{className:"text-xl font-bold text-indigo-400 mb-2",children:"The Basics"}),e.jsxs("ul",{className:"list-disc pl-5 space-y-2 text-sm",children:[e.jsxs("li",{children:["Everyone starts with ",e.jsx("strong",{children:"5 Dice"}),"."]}),e.jsxs("li",{children:["Only ",e.jsx("strong",{children:"you"})," can see your own dice."]}),e.jsx("li",{children:"Goal: Be the last player with dice remaining."}),e.jsxs("li",{children:[e.jsx("strong",{children:"1s (Aces) are Wild!"})," They count as any number, unless the bid is on 1s."]})]})]}),e.jsxs("div",{className:"bg-zinc-800/50 p-4 rounded-lg border border-zinc-700",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Bidding & Challenging"}),e.jsxs("ul",{className:"list-disc pl-5 space-y-2 text-sm",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Bid:"})," Claim a quantity of a specific face value on the ",e.jsx("em",{children:"entire table"}),' (e.g., "Five 4s").']}),e.jsxs("li",{children:[e.jsx("strong",{children:"Raise:"})," You must bid a higher quantity OR the same quantity with a higher face value."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Liar!:"})," If you don't believe the previous bid, challenge it!"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Result:"})," If the bid was valid, Challenger loses a die. If invalid, Bidder loses a die."]})]})]})]})})]})}),vt=({data:n,currentUserId:b,onClose:c})=>{if(!n)return null;const x=b===n.loserId,l=b===n.winnerId;let g="bg-zinc-800/95 border-zinc-500 text-white",z="animate-in fade-in zoom-in slide-in-from-bottom-10",E="bg-zinc-700 hover:bg-zinc-600 text-white border-zinc-500";l?(g="bg-green-900/95 border-green-500 text-green-100 shadow-[0_0_100px_rgba(34,197,94,0.5)]",E="bg-green-600 hover:bg-green-500 text-white border-green-400"):x&&(g="bg-red-900/95 border-red-500 text-red-100 shadow-[0_0_100px_rgba(239,68,68,0.5)]",z+=" animate-shake",E="bg-red-800 hover:bg-red-700 text-white border-red-400");const t=_[n.bidFace]||H;return e.jsxs("div",{className:"fixed inset-0 z-160 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",children:[x&&e.jsx("div",{className:"absolute inset-0 bg-red-500/10 z-0"}),l&&e.jsx("div",{className:"absolute inset-0 bg-green-500/10 z-0"}),e.jsxs("div",{className:`
      relative z-10 flex flex-col items-center justify-center p-8 rounded-3xl border-4 
      max-w-xl w-full text-center shadow-2xl duration-300
      ${g} ${z}
    `,children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-3xl font-black uppercase tracking-widest mb-2",children:"LIAR CALLED!"}),e.jsxs("p",{className:"text-lg opacity-80",children:[e.jsx("span",{className:"font-bold border-b border-white/30 pb-0.5",children:n.challengerName})," ","called out"," ",e.jsx("span",{className:"font-bold border-b border-white/30 pb-0.5",children:n.bidderName})]})]}),e.jsxs("div",{className:"bg-black/30 p-6 rounded-xl w-full mb-8 border border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-center gap-8 mb-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs uppercase tracking-wider opacity-70 mb-1",children:"Bid"}),e.jsxs("div",{className:"text-4xl font-black flex items-center gap-2 justify-center",children:[n.bidQuantity," ",e.jsx("span",{className:"text-sm opacity-50",children:"x"})," ",e.jsx(t,{size:32})]})]}),e.jsx("div",{className:"h-12 w-px bg-white/20"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs uppercase tracking-wider opacity-70 mb-1",children:"Found"}),e.jsx("div",{className:`text-4xl font-black ${n.actualCount>=n.bidQuantity?"text-green-400":"text-red-400"}`,children:n.actualCount})]})]}),e.jsx("p",{className:"text-sm italic opacity-75",children:n.actualCount>=n.bidQuantity?"The bid was truthful!":"The bid was a lie!"})]}),e.jsxs("div",{className:"text-2xl font-bold uppercase tracking-wide bg-black/40 px-6 py-3 rounded-full border border-white/20 mb-8",children:[n.loserName," loses a die!"]}),e.jsx("button",{onClick:c,className:`
            w-full py-4 rounded-xl font-bold text-lg uppercase tracking-widest border-2 shadow-lg
            transition-all transform hover:scale-[1.02] active:scale-[0.98]
            ${E}
          `,children:"Continue"})]})]})},zt=e.jsx("style",{children:`
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
      20%, 40%, 60%, 80% { transform: translateX(5px); }
    }
    .animate-shake {
      animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
    }
  `}),kt=({winnerName:n,onReturnToLobby:b,isHost:c})=>e.jsxs("div",{className:"fixed inset-0 z-155 bg-black/95 flex flex-col items-center justify-center animate-in fade-in duration-500",children:[e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_center,var(--tw-gradient-stops))] from-indigo-900/40 via-black to-black pointer-events-none"}),e.jsxs("div",{className:"z-10 text-center space-y-8 p-8",children:[e.jsx("div",{className:"mb-4",children:e.jsx(dt,{size:80,className:"text-yellow-400 mx-auto animate-bounce drop-shadow-[0_0_35px_rgba(250,204,21,0.6)]"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-2xl text-zinc-400 font-serif tracking-widest uppercase",children:"The Deadliest Ghost"}),e.jsx("h1",{className:"text-6xl md:text-8xl font-black text-transparent bg-clip-text bg-linear-to-b from-yellow-300 to-yellow-600 drop-shadow-2xl",children:n})]}),e.jsx("div",{className:"pt-12",children:c?e.jsx("button",{onClick:b,className:"group relative px-8 py-4 bg-zinc-100 text-black font-black text-xl rounded-full hover:bg-white hover:scale-105 transition-all shadow-[0_0_30px_rgba(255,255,255,0.3)]",children:e.jsxs("span",{className:"flex items-center gap-3",children:[e.jsx(Ce,{className:"group-hover:-rotate-180 transition-transform duration-500"}),"RETURN TO LOBBY"]})}):e.jsx("div",{className:"text-zinc-500 animate-pulse font-mono",children:"Waiting for Host to reset..."})})]})]});function It(){const[n,b]=o.useState(null),[c,x]=o.useState("menu"),[l,g]=o.useState(()=>localStorage.getItem($)||""),[z,E]=o.useState(""),[t,De]=o.useState(null),[ne,q]=o.useState(!1),[Y,S]=o.useState(""),[re,le]=o.useState(!1),[Re,oe]=o.useState(!1),[de,F]=o.useState(!1),[ce,D]=o.useState(!1),[K,xe]=o.useState(!1),[me,X]=o.useState(null),[j,Q]=o.useState(1),[L,ue]=o.useState(2),[k,$e]=o.useState(()=>localStorage.getItem("gameHub_playerName")||"");o.useEffect(()=>{k&&localStorage.setItem("gameHub_playerName",k)},[k]),o.useEffect(()=>{(async()=>typeof __initial_auth_token<"u"&&__initial_auth_token?await Ue(te,__initial_auth_token):await Ye(te))();const s=Ve(te,b);return()=>s()},[]),o.useEffect(()=>{if(!l||!n)return;const i=pe(h(m,"artifacts",y,"public","data","rooms",l),s=>{if(s.exists()){const a=s.data();if(!a.players.some(r=>r.id===n.uid)){g(""),localStorage.removeItem($),x("menu"),S("Connection Terminated.");return}De(a),a.status==="lobby"?x("lobby"):x("game"),a.feedbackTrigger?a.feedbackTrigger.id!==t?.feedbackTrigger?.id&&X(a.feedbackTrigger):X(null),a.currentBid&&!t?.currentBid&&(Q(a.currentBid.quantity),ue(a.currentBid.face))}else g(""),localStorage.removeItem($),x("menu"),S("Room vanished into the ether.")});return()=>i()},[l,n,t?.feedbackTrigger?.id]),o.useEffect(()=>{const i=pe(h(m,"game_hub_settings","config"),s=>{s.exists()&&s.data()[wt]?.maintenance?oe(!0):oe(!1)});return()=>i()},[]);const Be=async()=>{if(!k.trim())return S("Name required.");q(!0);const i="123456789ABCDEFGHIJKLMNPQRSTUVWXYZ";let s="";for(let r=0;r<6;r++)s+=i.charAt(Math.floor(Math.random()*i.length));const a={roomId:s,hostId:n.uid,status:"lobby",players:[{id:n.uid,name:k,dice:[],diceCount:5,eliminated:!1,ready:!0}],logs:[],turnIndex:0,currentBid:null,turnState:"IDLE",feedbackTrigger:null,winner:null,roundLoserId:null,revealReadyIds:[]};try{await Ke(h(m,"artifacts",y,"public","data","rooms",s),a),g(s),localStorage.setItem($,s),x("lobby")}catch{S("Network error.")}q(!1)},Ee=async()=>{if(!z||!k)return S("Code and Name required.");q(!0);try{const i=h(m,"artifacts",y,"public","data","rooms",z),s=await Xe(i);if(!s.exists())throw new Error("Room not found.");const a=s.data();if(a.status!=="lobby")throw new Error("Game already in progress.");if(a.players.length>=6)throw new Error("Table full.");a.players.find(r=>r.id===n.uid)||await C(i,{players:W({id:n.uid,name:k,dice:[],diceCount:5,eliminated:!1,ready:!0})}),g(z),localStorage.setItem($,z)}catch(i){S(i.message)}q(!1)},he=async()=>{if(!l)return;const i=h(m,"artifacts",y,"public","data","rooms",l);if(t.hostId===n.uid)await Qe(i);else{const a=t.players.filter(r=>r.id!==n.uid);await C(i,{players:a})}g(""),localStorage.removeItem($),x("menu"),D(!1)},Le=async i=>{if(t.hostId!==n.uid)return;const s=t.players.filter(a=>a.id!==i);await C(h(m,"artifacts",y,"public","data","rooms",l),{players:s})},be=async()=>{if(!t)return;const i=t.players.map(s=>s.id===n.uid?{...s,ready:!s.ready}:s);await C(h(m,"artifacts",y,"public","data","rooms",l),{players:i})},ge=i=>{const s=[];for(let a=0;a<i;a++)s.push(Math.floor(Math.random()*6)+1);return s.sort()},Te=()=>{const i=t.roomId,s=()=>{le(!0),setTimeout(()=>le(!1),2e3),triggerFeedback&&triggerFeedback("neutral","COPIED!","",A)};try{navigator.clipboard.writeText(i),s()}catch{const r=document.createElement("textarea");r.value=i,document.body.appendChild(r),r.select(),document.execCommand("copy"),document.body.removeChild(r),s()}},fe=async()=>{if(t.players.length<2)return S("Need 2+ Players.");const i=t.players.map(a=>({...a,diceCount:5,dice:ge(5),eliminated:!1,ready:!1})),s=Math.floor(Math.random()*i.length);await C(h(m,"artifacts",y,"public","data","rooms",l),{status:"playing",players:i,turnIndex:s,currentBid:null,turnState:"BIDDING",feedbackTrigger:null,winner:null,revealReadyIds:[],roundLoserId:null,logs:[{id:Date.now().toString(),text:"The Haunt Begins. 5 Dice each.",type:"neutral"}]})},Me=async()=>{const i=t.currentBid,s=t.players.find(r=>r.id===n.uid);if(i&&(j<i.quantity||j===i.quantity&&L<=i.face))return;let a=(t.turnIndex+1)%t.players.length;for(;t.players[a].eliminated;)a=(a+1)%t.players.length;await C(h(m,"artifacts",y,"public","data","rooms",l),{currentBid:{quantity:j,face:L,playerId:n.uid,playerName:s.name},turnIndex:a,logs:W({id:Date.now().toString(),text:`${s.name} bids: ${j}x ${L}s`,type:"neutral"})})},Ge=async()=>{const i=t.currentBid,s=t.players.find(p=>p.id===n.uid),a=t.players.find(p=>p.id===i.playerId);let r=0,f=[];t.players.forEach(p=>{p.eliminated||(f=[...f,...p.dice],p.dice.forEach(T=>{(T===i.face||T===1&&i.face!==1)&&r++}))});const u=r>=i.quantity,N=u?s.id:a.id,R=u?a.id:s.id,P=u?s.name:a.name,d={id:Date.now(),type:"challenge_result",challengerName:s.name,bidderName:a.name,bidQuantity:i.quantity,bidFace:i.face,actualCount:r,loserId:N,winnerId:R,loserName:P};let v=[{id:Date.now().toString(),text:`${s.name} called LIAR on ${a.name}!`,type:"warning"},{id:Date.now()+1,text:`Result: ${r} matching dice found (Bid: ${i.quantity}).`,type:u?"success":"danger"},{id:Date.now()+2,text:`${P} loses a die.`,type:"danger"}];await C(h(m,"artifacts",y,"public","data","rooms",l),{turnState:"REVEAL",feedbackTrigger:d,logs:W(...v),roundLoserId:N,revealReadyIds:[]})},Ae=async()=>{if(!t||!n)return;const i=h(m,"artifacts",y,"public","data","rooms",l);try{await Je(m,async s=>{const a=await s.get(i);if(!a.exists())return;const r=a.data();if(r.revealReadyIds?.includes(n.uid))return;const f=[...r.revealReadyIds||[],n.uid],u=r.players.find(d=>d.id===r.roundLoserId),N=u&&u.diceCount<=1,P=r.players.filter(d=>!(d.eliminated||d.id===r.roundLoserId&&N)).length;if(f.length>=P){const d=[...r.players],v=d.findIndex(I=>I.id===r.roundLoserId);d[v].diceCount-=1;let p="",T="BIDDING",Z=null,Oe=null;d[v].diceCount<=0&&(d[v].eliminated=!0,p=`${d[v].name} has run out of soul. Eliminated.`);const ee=d.filter(I=>!I.eliminated);ee.length===1?(T="FINISHED",Z=ee[0].name,Oe=null):d.forEach(I=>{I.eliminated?I.dice=[]:I.dice=ge(I.diceCount)});let M=v;if(d[v].eliminated)for(M=(v+1)%d.length;d[M].eliminated&&ee.length>1;)M=(M+1)%d.length;const G={players:d,turnState:T==="FINISHED"?"IDLE":"BIDDING",currentBid:null,turnIndex:M,revealReadyIds:[],roundLoserId:null};p&&(G.logs=W({id:Date.now().toString(),text:p,type:"danger"})),Z&&(G.status="finished",G.winner=Z,G.feedbackTrigger=null),s.update(i,G)}else s.update(i,{revealReadyIds:f})})}catch(s){console.error("Transaction failed: ",s)}},J=async()=>{const i=t.players.map(s=>({...s,dice:[],diceCount:5,eliminated:!1,ready:!0}));await C(h(m,"artifacts",y,"public","data","rooms",l),{status:"lobby",players:i,logs:[],currentBid:null,turnState:"IDLE",winner:null,feedbackTrigger:null,revealReadyIds:[],roundLoserId:null})},w=t?.players.find(i=>i.id===n?.uid),He=t?.players[t?.turnIndex]?.id===n?.uid;if(Re)return e.jsxs("div",{className:"min-h-screen bg-gray-950 flex flex-col items-center justify-center text-white p-4 text-center",children:[e.jsx(Ne,{}),e.jsxs("div",{className:"bg-orange-500/10 p-8 rounded-2xl border border-orange-500/30",children:[e.jsx(We,{size:64,className:"text-orange-500 mx-auto mb-4 animate-bounce"}),e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Under Maintenance"}),e.jsx("p",{className:"text-gray-400",children:"The spirits are resting. The tavern is closed until dusk."})]}),e.jsx("div",{className:"h-8"}),e.jsx("a",{href:"/rawfids-gamehub/",children:e.jsx("div",{className:"flex items-center justify-center gap-3 mb-2",children:e.jsx("div",{className:"text-center pb-12 animate-pulse",children:e.jsxs("div",{className:"inline-flex items-center gap-3 px-8 py-4 bg-slate-900/50 rounded-full border border-indigo-500/20 text-indigo-300 font-bold tracking-widest text-sm uppercase backdrop-blur-sm",children:[e.jsx(ye,{size:16})," Visit Gamehub...Try our other releases..."," ",e.jsx(ye,{size:16})]})})})}),e.jsx(se,{})]});if(!n)return e.jsx("div",{className:"min-h-screen bg-zinc-950 flex items-center justify-center text-indigo-500 animate-pulse",children:"Summoning souls..."});if(l&&!t&&!Y)return e.jsxs("div",{className:"min-h-screen bg-zinc-950 flex flex-col items-center justify-center text-white p-4",children:[e.jsx(U,{}),e.jsxs("div",{className:"bg-zinc-900/80 backdrop-blur p-8 rounded-2xl border border-zinc-700 shadow-2xl flex flex-col items-center gap-4 animate-in fade-in zoom-in duration-300",children:[e.jsx(et,{size:48,className:"text-indigo-500 animate-spin"}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Reconnecting..."}),e.jsx("p",{className:"text-zinc-400 text-sm",children:"Resuming your session"})]})]})]});if(c==="menu")return e.jsxs("div",{className:"min-h-screen bg-zinc-950 text-white flex flex-col items-center justify-center p-4 relative overflow-hidden font-sans",children:[e.jsx(U,{}),e.jsx("nav",{className:"absolute top-0 left-0 w-full p-4 z-50",children:e.jsxs("a",{href:"/rawfids-gamehub/",className:"flex items-center gap-2 text-indigo-800 rounded-lg font-bold shadow-md hover:text-indigo-400 transition-colors w-fit animate-pulse",children:[e.jsx(tt,{}),e.jsx("span",{children:"Back to Gamehub"})]})}),de&&e.jsx(ze,{onClose:()=>F(!1)}),e.jsxs("div",{className:"z-10 text-center mb-10",children:[e.jsx(H,{size:64,className:"text-indigo-400 mx-auto mb-4 animate-bounce drop-shadow-[0_0_15px_rgba(129,140,248,0.5)]"}),e.jsx("h1",{className:"text-5xl md:text-7xl font-black text-transparent bg-clip-text bg-linear-to-b from-indigo-300 to-zinc-500 font-serif tracking-widest drop-shadow-md",children:"GHOST DICE"}),e.jsx("p",{className:"text-white-400/60 tracking-[0.3em] uppercase mt-2",children:"Dead Men Tell No Tales"})]}),e.jsxs("div",{className:"bg-zinc-900/80 backdrop-blur border border-indigo-500/30 p-8 rounded-2xl w-full max-w-md shadow-2xl z-10 animate-in slide-in-from-bottom-10 duration-700 delay-100",children:[Y&&e.jsx("div",{className:"bg-red-900/50 text-red-200 p-2 mb-4 rounded text-center text-sm border border-red-800",children:Y}),e.jsx("input",{className:"w-full bg-black/50 border border-zinc-600 p-3 rounded mb-4 text-white placeholder-zinc-500 focus:border-indigo-500 outline-none transition-colors",placeholder:"Soul Name",value:k,onChange:i=>$e(i.target.value)}),e.jsxs("button",{onClick:Be,disabled:ne,className:"w-full bg-linear-to-r from-indigo-700 to-zinc-600 hover:from-indigo-600 hover:to-zinc-500 p-4 rounded font-bold mb-4 flex items-center justify-center gap-2 border border-indigo-500/30 shadow-[0_0_15px_rgba(99,102,241,0.2)] transition-all",children:[e.jsx(je,{size:20})," Host Séance"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mb-4",children:[e.jsx("input",{className:"w-full sm:flex-1 bg-black/50 border border-zinc-600 p-3 rounded text-white placeholder-zinc-500 uppercase font-mono tracking-wider focus:border-indigo-500 outline-none",placeholder:"CODE",value:z,onChange:i=>E(i.target.value.toUpperCase())}),e.jsx("button",{onClick:Ee,disabled:ne,className:"w-full sm:w-auto bg-zinc-800 hover:bg-zinc-700 border border-zinc-600 px-6 py-3 rounded font-bold transition-colors",children:"Join"})]}),e.jsxs("button",{onClick:()=>F(!0),className:"w-full text-sm text-zinc-400 hover:text-white flex items-center justify-center gap-2 py-2",children:[e.jsx(ae,{size:16})," The Grimoire"]})]}),e.jsxs("div",{className:"absolute bottom-4 text-slate-600 text-xs text-center",children:["Inspired by Liar's Dice. A tribute game.",e.jsx("br",{}),"Developed by ",e.jsx("strong",{children:"RAWFID K SHUVO"}),". Visit"," ",e.jsx("a",{href:"/rawfids-gamehub/",rel:"noopener noreferrer",className:"text-indigo-500 underline hover:text-indigo-600",children:"GAMEHUB"})," ","for more games."]})]});if(c==="lobby"&&t){const i=t.hostId===n.uid;return e.jsxs("div",{className:"min-h-screen bg-zinc-950 text-white flex flex-col items-center justify-center p-6 relative",children:[e.jsx(U,{}),e.jsx(Ne,{}),ce&&e.jsx(ve,{onConfirmLeave:he,onCancel:()=>D(!1),isHost:i,inGame:!1}),e.jsxs("div",{className:"z-10 w-full max-w-lg bg-zinc-900/90 backdrop-blur p-8 rounded-2xl border border-indigo-900/50 shadow-2xl mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8 border-b border-zinc-700 pb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg md:text-xl text-indigo-400 font-bold uppercase",children:"Crypt"}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsx("div",{className:"text-2xl md:text-3xl font-mono text-white",children:l}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:Te,className:"p-2 hover:bg-white/10 rounded-full transition-colors text-gray-400 hover:text-white",children:re?e.jsx(A,{size:16,className:"text-green-500"}):e.jsx(st,{size:16})}),re&&e.jsx("div",{className:"absolute left-full ml-2 top-1/2 -translate-y-1/2 bg-indigo-500 text-black text-xs font-bold px-2 py-1 rounded shadow-lg animate-fade-in-up whitespace-nowrap",children:"Copied!"})]})]})]}),e.jsx("button",{onClick:()=>D(!0),className:"p-2 bg-red-900/30 hover:bg-red-900/50 rounded text-red-300",children:e.jsx(ie,{size:16})})]}),e.jsxs("div",{className:"bg-black/20 rounded-xl p-4 mb-8 border border-zinc-800",children:[e.jsx("h3",{className:"text-zinc-500 text-xs uppercase tracking-wider mb-4 flex justify-between",children:e.jsxs("span",{children:["Souls (",t.players.length,")"]})}),e.jsxs("div",{className:"space-y-2",children:[t.players.map((s,a)=>{const r=B[a%B.length];return e.jsxs("div",{className:`flex items-center justify-between p-3 rounded border ${r.bg} ${r.border}`,children:[e.jsxs("span",{className:`font-bold flex items-center gap-2 ${r.color}`,children:[e.jsx(we,{size:14})," ",s.name," ",s.id===t.hostId&&e.jsx(je,{size:14,className:"text-yellow-500"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-green-500 text-xs flex items-center gap-1",children:[e.jsx(A,{size:12})," Present"]}),i&&s.id!==n.uid&&e.jsx("button",{onClick:()=>Le(s.id),className:"p-1.5 text-zinc-500 hover:text-red-400 hover:bg-red-900/20 rounded-full transition-colors",title:"Kick Soul",children:e.jsx(it,{size:14})})]})]},s.id)}),t.players.length<2&&e.jsx("div",{className:"text-center text-zinc-500 italic text-sm py-2",children:"Waiting for more souls..."})]})]}),i?e.jsx("button",{onClick:fe,disabled:t.players.length<2,className:`w-full py-4 rounded-xl font-bold text-lg shadow-lg transition-all flex items-center justify-center gap-2 ${t.players.length>=2?"bg-indigo-700 hover:bg-indigo-600 text-white shadow-indigo-900/20":"bg-zinc-800 cursor-not-allowed text-zinc-500"}`,children:t.players.length<2?"Need 2+ Players...":"Begin Haunt"}):e.jsx("div",{className:"text-center text-indigo-400/60 animate-pulse font-serif italic",children:"Waiting for Host..."})]}),e.jsx(se,{})]})}if(c==="game"&&t){const i=t.players.findIndex(a=>a.id===n.uid),s=B[i%B.length];return e.jsxs("div",{className:"min-h-screen bg-zinc-950 text-white flex flex-col relative overflow-hidden font-sans",children:[zt," ",e.jsx(U,{}),t.status==="finished"&&e.jsx(kt,{winnerName:t.winner,isHost:t.hostId===n.uid,onReturnToLobby:J}),me&&t.status!=="finished"&&e.jsx(vt,{data:me,currentUserId:n.uid,onClose:()=>X(null)}),de&&e.jsx(ze,{onClose:()=>F(!1)}),K&&e.jsx(Nt,{logs:t.logs,onClose:()=>xe(!1)}),ce&&e.jsx(ve,{onConfirmLeave:he,onCancel:()=>D(!1),isHost:t.hostId===n.uid,onConfirmLobby:()=>{J(),D(!1)},inGame:!0}),e.jsxs("div",{className:"h-14 bg-zinc-900/80 border-b border-zinc-800 flex items-center justify-between px-4 z-160 backdrop-blur-md sticky top-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-serif text-indigo-500 font-bold tracking-wider hidden md:block",children:"GHOST DICE"}),e.jsx("span",{className:"text-xs text-zinc-500 bg-black/50 px-2 py-1 rounded",children:"Graveyard"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>F(!0),className:"p-2 hover:bg-zinc-800 rounded text-zinc-400",children:e.jsx(ae,{size:18})}),e.jsx("button",{onClick:()=>xe(!K),className:`p-2 rounded-full ${K?"bg-indigo-900 text-indigo-400":"text-gray-400 hover:bg-gray-800"}`,children:e.jsx(Ie,{size:18})}),e.jsx("button",{onClick:()=>D(!0),className:"p-2 hover:bg-red-900/50 rounded text-red-400",children:e.jsx(ie,{size:18})})]})]}),e.jsxs("div",{className:"flex-1 p-4 flex flex-col items-center relative z-10 max-w-6xl mx-auto w-full gap-4",children:[e.jsxs("div",{className:`w-full max-w-md ${s.bg} p-6 rounded-2xl border border-indigo-500/20 flex flex-col items-center justify-center min-h-[160px] animate-in fade-in zoom-in`,children:[e.jsx("div",{className:`text-xs ${s.color} uppercase tracking-widest mb-2`,children:"Current Bid"}),t.currentBid?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-6xl font-black text-white drop-shadow-lg",children:t.currentBid.quantity}),e.jsx("span",{className:"text-4xl text-zinc-500",children:"x"}),V.createElement(_[t.currentBid.face],{size:64,className:`${s.color} drop-shadow-[0_0_10px_rgba(129,140,248,0.5)]`})]}),e.jsxs("div",{className:"mt-2 text-zinc-400 text-sm",children:["by"," ",e.jsx("span",{className:"text-white font-bold",children:t.currentBid.playerName})]})]}):e.jsx("div",{className:"text-zinc-600 italic",children:"No bids placed..."})]}),e.jsx("div",{className:"flex gap-4 justify-center flex-wrap w-full my-4",children:t.players.map((a,r)=>{if(a.id===n.uid)return null;const f=t.turnIndex===r,u=B[r%B.length];return e.jsxs("div",{className:`
                                relative bg-zinc-900/90 p-4 rounded-xl border-2 w-32 md:w-40 transition-all flex flex-col items-center
                                ${f?`${u.border} ${u.shadow} scale-105`:"border-zinc-700"}
                                ${a.eliminated?"opacity-40 grayscale":""}
                            `,children:[t.turnState==="REVEAL"&&!a.eliminated&&t.revealReadyIds?.includes(a.id)&&e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx(A,{size:16,className:"text-green-500"})}),e.jsx("div",{className:"absolute top-2 right-2 flex gap-0.5",children:[...Array(a.diceCount)].map((N,R)=>e.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${f?"bg-white":"bg-zinc-600"}`},R))}),a.eliminated?e.jsx(rt,{size:32,className:"text-red-500 mb-2"}):e.jsx(lt,{size:32,className:`${f?u.color+" animate-bounce":"text-zinc-600"}`}),e.jsx("span",{className:`font-bold text-sm truncate w-full text-center ${f?u.color:"text-zinc-400"}`,children:a.name}),t.turnState==="REVEAL"&&!a.eliminated&&e.jsx("div",{className:"absolute inset-0 bg-black/90 rounded-xl flex items-center justify-center z-10 p-2 flex-wrap gap-1",children:a.dice.map((N,R)=>V.createElement(_[N],{key:R,size:16,className:N===t.currentBid?.face||N===1?"text-white":"text-zinc-700"}))})]},a.id)})}),e.jsxs("div",{className:`w-full max-w-2xl bg-zinc-900/95 p-4 rounded-t-3xl border-t-4 ${s.border} backdrop-blur-md mt-auto shadow-2xl z-20 transition-all ${w.eliminated&&t.status!=="finished"?"grayscale opacity-50 pointer-events-none":""}`,children:[(()=>{const r=t.roundLoserId===n.uid&&w.diceCount<=1;return t.turnState==="REVEAL"&&!w.eliminated&&!r&&t.status!=="finished"?e.jsx("div",{className:"absolute -top-16 left-0 right-0 flex justify-center z-30",children:t.revealReadyIds?.includes(n.uid)?e.jsxs("div",{className:"bg-zinc-900 px-6 py-2 rounded-full border border-green-500 text-green-500 font-bold flex items-center gap-2",children:[e.jsx(A,{size:18})," Ready"]}):e.jsxs("button",{onClick:Ae,className:`
                        px-8 py-3 rounded-full font-black text-lg shadow-xl uppercase tracking-widest flex items-center gap-2 animate-bounce
                        ${s.bg} ${s.text} ${s.border} border-2
                      `,children:[e.jsx(H,{size:24})," Roll Dice"]})}):null})(),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(we,{className:s.color}),e.jsx("span",{className:`font-bold text-xl ${s.color}`,children:w.name}),e.jsxs("div",{className:`px-3 py-1 rounded-full text-xs border ${s.bg} ${s.color} ${s.border}`,children:[w.diceCount," Dice Left"]})]}),e.jsx("div",{className:"flex flex-wrap justify-center gap-2 bg-black/40 p-2 rounded-xl",children:w.dice.map((a,r)=>e.jsx("div",{className:`
                                    ${s.bg} rounded-lg p-1 shadow-inner
                                     ${t.currentBid&&(a===t.currentBid.face||a===1)?`ring-2 ${s.ring}`:""}
                                 `,children:V.createElement(_[a],{size:32,className:s.color})},r))})]}),e.jsx("div",{className:"min-h-[100px]",children:t.status==="finished"?e.jsxs("div",{className:"text-center",children:[e.jsxs("h3",{className:"text-3xl font-black text-indigo-400 mb-4",children:[t.winner," Wins!"]}),e.jsx("div",{className:"flex flex-wrap justify-center gap-2 mb-6",children:t.players.map(a=>e.jsxs("div",{className:`px-3 py-1 rounded-full text-[10px] uppercase font-bold border ${a.ready?"bg-green-900/30 border-green-500 text-green-400":"bg-zinc-800 border-zinc-600 text-zinc-500"}`,children:[a.name," ",a.ready&&"✓"]},a.id))}),t.hostId===n.uid?e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsxs("button",{onClick:fe,disabled:!t.players.every(a=>a.ready),className:"bg-indigo-600 hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed px-6 py-3 rounded-xl font-bold text-white flex gap-2 items-center",children:[e.jsx(Ce,{size:18})," Restart"]}),e.jsxs("button",{onClick:J,disabled:!t.players.every(a=>a.ready),className:"bg-zinc-700 hover:bg-zinc-600 disabled:opacity-50 disabled:cursor-not-allowed px-6 py-3 rounded-xl font-bold text-white flex gap-2 items-center",children:[e.jsx(Se,{size:18})," Lobby"]})]}),!t.players.every(a=>a.ready)&&e.jsx("div",{className:"text-zinc-500 text-xs animate-pulse mt-2",children:"Waiting for all souls to be ready..."}),!w.ready&&e.jsx("button",{onClick:be,className:"text-xs text-indigo-400 hover:text-indigo-300 underline mt-2",children:"Mark Self Ready"})]}):e.jsxs("div",{className:"w-full max-w-xs mx-auto",children:[e.jsx("button",{onClick:be,className:`w-full py-3 rounded-xl font-bold text-lg shadow-lg transition-all mb-2 ${w.ready?"bg-green-900/30 border border-green-500 text-green-400":"bg-indigo-600 hover:bg-indigo-500 text-white"}`,children:w.ready?"READY":"MARK READY"}),e.jsx("div",{className:"text-zinc-500 text-xs italic",children:"Waiting for Host..."})]})]}):He&&t.turnState==="BIDDING"?e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex gap-4 items-center justify-center",children:[e.jsxs("div",{className:"flex items-center bg-zinc-800 rounded-lg border border-zinc-700",children:[e.jsx("button",{onClick:()=>Q(Math.max(1,j-1)),className:"p-3 hover:bg-zinc-700 text-zinc-400",children:"-"}),e.jsx("span",{className:"w-12 text-center font-bold text-xl",children:j}),e.jsx("button",{onClick:()=>Q(j+1),className:"p-3 hover:bg-zinc-700 text-white",children:"+"})]}),e.jsx("span",{className:"text-zinc-500",children:"x"}),e.jsx("div",{className:"flex gap-1 bg-zinc-800 p-1 rounded-lg border border-zinc-700 overflow-x-auto",children:[1,2,3,4,5,6].map(a=>e.jsx("button",{onClick:()=>ue(a),className:`p-2 rounded-md transition-all ${L===a?`${s.bg} ${s.color} shadow-lg`:"hover:bg-zinc-700 text-zinc-500"}`,children:V.createElement(_[a],{size:24})},a))})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("button",{onClick:Ge,disabled:!t.currentBid,className:"bg-red-900/80 hover:bg-red-800 disabled:opacity-50 disabled:bg-zinc-800 text-red-200 py-4 rounded-xl font-bold text-lg shadow-lg border border-red-700 flex items-center justify-center gap-2",children:[e.jsx(ot,{size:20})," LIAR!"]}),e.jsxs("button",{onClick:Me,disabled:t.currentBid&&(j<t.currentBid.quantity||j===t.currentBid.quantity&&L<=t.currentBid.face),className:`col-span-2 ${s.bg} border ${s.border} ${s.text} hover:opacity-80 disabled:opacity-50 disabled:bg-zinc-800 disabled:border-zinc-700 disabled:text-zinc-500 py-4 rounded-xl font-bold text-lg shadow-lg flex items-center justify-center gap-2`,children:[e.jsx(at,{size:20})," Place Bid"]})]})]}):e.jsx("div",{className:"text-center text-zinc-500 animate-pulse py-8",children:t.turnState==="REVEAL"?"Waiting for all players to roll the dice...":`Waiting for ${t.players[t.turnIndex]?.name}...`})})]})]}),e.jsx(se,{})]})}return null}Ze.createRoot(document.getElementById("root")).render(e.jsx(o.StrictMode,{children:e.jsx(It,{})}));
