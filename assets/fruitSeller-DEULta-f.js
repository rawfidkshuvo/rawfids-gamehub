import{c as Re,i as Ee,g as _e,a as Me,r as f,e as Pe,d as g,o as le,j as e,H as Ae,S as oe,u as C,n as $e,s as Te,h as Le,p as ie,q as W,t as Oe,X as he,m as Be}from"./x-vdu6PxPT.js";import{L as Ge,S as Fe,B as de,C as V,a as He,b as J}from"./step-back-DgPuYW0s.js";import{C as M,B as Ue}from"./citrus-DDA9mzQF.js";import{T as De}from"./triangle-alert-CO8fZ1I9.js";import{U as ce}from"./users-Dsm1N_Bg.js";import{C as be}from"./crown-DhFWzZA3.js";import{B as xe}from"./bot-DG0ASA9H.js";import{H as ge}from"./history-r3RmdCN7.js";import{A as pe}from"./arrow-right-88Wq9XMb.js";import{C as Ye,A as We,G as Ve}from"./grape-BVuBiulH.js";import{T as Je}from"./trophy-CV5zFLFQ.js";import{H as ye}from"./house-BdFnrmDF.js";import{P as Ke}from"./play-u0q38rUa.js";import{C as Xe}from"./check-CGP4nRzB.js";import{S as qe}from"./shopping-bag-DZipewoa.js";const Qe=[["path",{d:"M15 21v-5a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v5",key:"slp6dd"}],["path",{d:"M17.774 10.31a1.12 1.12 0 0 0-1.549 0 2.5 2.5 0 0 1-3.451 0 1.12 1.12 0 0 0-1.548 0 2.5 2.5 0 0 1-3.452 0 1.12 1.12 0 0 0-1.549 0 2.5 2.5 0 0 1-3.77-3.248l2.889-4.184A2 2 0 0 1 7 2h10a2 2 0 0 1 1.653.873l2.895 4.192a2.5 2.5 0 0 1-3.774 3.244",key:"o0xfot"}],["path",{d:"M4 10.95V19a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8.05",key:"wn3emo"}]],me=Re("store",Qe),Ze={apiKey:"AIzaSyBjIjK53vVJW1y5RaqEFGSFp0ECVDBEe1o",authDomain:"game-hub-ff8aa.firebaseapp.com",projectId:"game-hub-ff8aa",storageBucket:"game-hub-ff8aa.firebasestorage.app",messagingSenderId:"586559578902",appId:"1:586559578902:web:91da4fa4ace038d16aa637"},je=Ee(Ze),U=_e(je),p=Me(je),y=typeof __app_id<"u"?__app_id:"fruit-seller-game",et="6",K={GRAPE:{name:"Grape",icon:Ve,color:"text-violet-400",bg:"bg-gray-900",border:"border-violet-500",desc:"Vine Ripened",value:1},APPLE:{name:"Apple",icon:We,color:"text-red-500",bg:"bg-gray-900",border:"border-red-600",desc:"Crisp & Crunchy",value:2},ORANGE:{name:"Orange",icon:M,color:"text-orange-500",bg:"bg-gray-900",border:"border-orange-600",desc:"Citrus Energy",value:3},BANANA:{name:"Banana",icon:Ue,color:"text-yellow-400",bg:"bg-gray-900",border:"border-yellow-500",desc:"High Potassium",value:4},LEMON:{name:"Lemon",icon:M,color:"text-lime-400",bg:"bg-gray-900",border:"border-lime-500",desc:"Sour Power",value:5},CHERRY:{name:"Cherry",icon:Ye,color:"text-pink-500",bg:"bg-gray-900",border:"border-pink-600",desc:"Sweet & Tart",value:6}},tt=["GRAPE","APPLE","ORANGE","BANANA","LEMON","CHERRY"],st=a=>{let d=a.length,i;for(;d!==0;)i=Math.floor(Math.random()*d),d--,[a[d],a[i]]=[a[i],a[d]];return a},at=a=>{const d=tt.slice(0,a);let i=[];return d.forEach(c=>{for(let o=0;o<5;o++)i.push({type:c,id:`${c}-${o}-${Math.random().toString(36).substr(2,5)}`})}),st(i)},rt=a=>{const d={};a.forEach(x=>{d[x.type]=(d[x.type]||0)+1});let i=null,c=-1;Object.entries(d).forEach(([x,t])=>{t>c&&(c=t,i=x)});let o=a.map((x,t)=>({...x,index:t})).filter(x=>x.type!==i);return o.length===0?0:(o.sort((x,t)=>(d[x.type]||0)-(d[t.type]||0)),o[0].index)},T=({isShaking:a})=>e.jsxs("div",{className:`absolute inset-0 overflow-hidden pointer-events-none z-0 ${a?"animate-shake bg-red-900/20":""}`,children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-full bg-[radial-gradient(ellipse_at_top,var(--tw-gradient-stops))] from-yellow-900/20 via-gray-950 to-black"}),e.jsx("div",{className:"absolute top-0 left-0 w-full h-full opacity-10",children:[...Array(20)].map((d,i)=>{const c=Object.keys(K),o=K[c[i%c.length]].icon;return e.jsx("div",{className:"absolute animate-float text-white/60",style:{left:`${Math.random()*100}%`,top:`${Math.random()*100}%`,animationDuration:`${10+Math.random()*20}s`,transform:`scale(${.5+Math.random()})`},children:e.jsx(o,{size:32})},i)})}),e.jsx("style",{children:`
      @keyframes float {
        0%, 100% { transform: translateY(0) rotate(0deg); }
        50% { transform: translateY(-20px) rotate(10deg); }
      }
      .animate-float { animation: float infinite ease-in-out; }
      
      @keyframes shake {
        0%, 100% { transform: translateX(0); }
        10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
        20%, 40%, 60%, 80% { transform: translateX(5px); }
      }
      .animate-shake { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
    `})]}),D=()=>e.jsxs("div",{className:"flex items-center justify-center gap-1 opacity-40 mt-auto pb-2 pt-2 relative z-10",children:[e.jsx(M,{size:12,className:"text-orange-400"}),e.jsx("span",{className:"text-[10px] font-black tracking-widest text-orange-400 uppercase",children:"FRUIT SELLER"})]}),ue=()=>e.jsxs("div",{className:"flex items-center justify-center gap-1 opacity-40 mt-auto pb-2 pt-2 relative z-10",children:[e.jsx(M,{size:22,className:"text-orange-400"}),e.jsx("span",{className:"text-[20px] font-black tracking-widest text-orange-400 uppercase",children:"FRUIT SELLER"})]}),fe=({onConfirmLeave:a,onConfirmLobby:d,onCancel:i,isHost:c,inGame:o})=>e.jsx("div",{className:"fixed inset-0 bg-black/90 z-200 flex items-center justify-center p-4 animate-in fade-in",children:e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 p-6 max-w-sm w-full text-center shadow-2xl",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Close Stall?"}),e.jsx("p",{className:"text-slate-400 mb-6 text-sm",children:c?"Closing the stall will end the game for everyone!":"Leaving now will disconnect you from the market."}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("button",{onClick:i,className:"bg-slate-700 hover:bg-slate-600 text-white py-3 rounded font-bold transition-colors",children:"Stay (Cancel)"}),o&&c&&e.jsxs("button",{onClick:d,className:"py-3 rounded font-bold transition-colors flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-500 text-white",children:[e.jsx(ye,{size:18})," Return Traders to Lobby"]}),e.jsxs("button",{onClick:a,className:"bg-red-600 hover:bg-red-500 text-white py-3 rounded font-bold transition-colors flex items-center justify-center gap-2",children:[e.jsx(J,{size:18})," ",c?"Close Market (End All)":"Leave Market"]})]})]})}),X=({children:a,onClick:d,disabled:i,variant:c="primary",className:o="",icon:x})=>{const t="relative px-6 py-3 rounded-lg font-serif font-bold transition-all transform active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg flex items-center justify-center gap-2 text-base md:text-lg",I={primary:"bg-orange-600 hover:bg-orange-500 text-white border-2 border-orange-800 shadow-orange-900/30",danger:"bg-red-700 hover:bg-red-600 text-white border-2 border-red-900",secondary:"bg-slate-700 hover:bg-slate-600 text-slate-200 border-2 border-slate-600",success:"bg-emerald-700 hover:bg-emerald-600 text-white border-2 border-emerald-900",ghost:"bg-transparent hover:bg-white/10 text-slate-300 border border-transparent"};return e.jsxs("button",{onClick:d,disabled:i,className:`${t} ${I[c]} ${o}`,children:[x&&e.jsx(x,{size:18}),a]})},nt=({type:a,onClick:d,disabled:i,highlight:c,small:o,tiny:x,isFaceDown:t=!1,isOpponent:I=!1})=>{if(t)return e.jsx("div",{className:`
        ${x?"w-6 h-8 rounded-sm":o?"w-10 h-14 rounded":"w-20 h-32 md:w-24 md:h-36 rounded-xl"} 
        bg-gray-800 border-2 border-gray-600 flex items-center justify-center shadow-lg transition-transform
        ${I?"":"hover:border-gray-400"}
      `,children:e.jsx("div",{className:"w-full h-full bg-[radial-gradient(ellipse_at_center,var(--tw-gradient-stops))] from-gray-700 to-gray-900 opacity-50 flex items-center justify-center",children:e.jsx(qe,{className:"text-gray-500 opacity-50",size:o?16:24})})});const m=K[a];return m?x?e.jsx("div",{className:`w-6 h-8 ${m.bg} border ${m.border} rounded-sm flex items-center justify-center shadow-sm`,children:e.jsx(m.icon,{className:`${m.color} w-3 h-3`})}):e.jsxs("button",{onClick:d,disabled:i,className:`
        relative rounded-xl border-2 transition-all flex flex-col items-center justify-between shadow-lg
        ${o?"w-10 h-14 p-1":"w-20 h-32 md:w-28 md:h-40 p-2"}
        ${c?"ring-4 ring-orange-500 -translate-y-6 z-50 shadow-[0_0_25px_rgba(249,115,22,0.5)]":"border-gray-600"}
        ${m.bg} ${m.border}
        ${i?"cursor-not-allowed brightness-75":"hover:scale-105 cursor-pointer hover:border-white hover:-translate-y-2 hover:z-40"}
      `,children:[e.jsx("div",{className:`absolute top-1 left-1.5 text-[10px] md:text-sm font-bold ${m.color} leading-none`,children:m.value}),e.jsx("div",{className:`absolute bottom-1 right-1.5 text-[10px] md:text-sm font-bold ${m.color} leading-none rotate-180`,children:m.value}),e.jsx("div",{className:"flex-1 flex items-center justify-center w-full",children:e.jsx(m.icon,{className:`${m.color} ${o?"w-4 h-4":"w-10 h-10 md:w-14 md:h-14"} drop-shadow-lg`})}),!o&&e.jsx("div",{className:"w-full text-center pb-1",children:e.jsx("div",{className:`font-bold text-[9px] md:text-xs ${m.color} tracking-wide uppercase truncate`,children:m.name})})]}):null},Y=({onClose:a})=>e.jsx("div",{className:"fixed inset-0 bg-black/95 z-100 flex items-center justify-center p-0 md:p-4 backdrop-blur-md animate-in fade-in",children:e.jsxs("div",{className:"bg-[#1e293b] md:rounded-2xl w-full max-w-5xl h-full md:h-[90vh] overflow-hidden border-none md:border-2 border-orange-500 shadow-2xl flex flex-col relative",children:[e.jsxs("div",{className:"p-4 md:p-6 border-b border-orange-500/30 flex justify-between items-center bg-black/40",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h2",{className:"text-2xl md:text-4xl font-serif font-black text-orange-500 uppercase tracking-widest drop-shadow-md",children:"Market Rules"}),e.jsx("span",{className:"text-slate-400 text-xs md:text-sm font-medium tracking-wide font-serif italic",children:"Trade, Collect, & Conquer"})]}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-white/10 rounded-full text-orange-500 transition-colors",children:e.jsx(he,{size:28})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 md:p-8 space-y-8 text-slate-300 scrollbar-thin scrollbar-thumb-orange-500 scrollbar-track-transparent",children:[e.jsxs("div",{className:"bg-[#0f172a] p-6 rounded-xl border border-slate-700 shadow-inner",children:[e.jsxs("h3",{className:"text-xl md:text-2xl font-bold text-[#f1f5f9] mb-4 flex items-center gap-3 font-serif",children:[e.jsx(Je,{className:"text-orange-500",size:24})," The Objective"]}),e.jsxs("p",{className:"text-sm md:text-lg leading-relaxed text-slate-400",children:["You must corner the market! The first player to collect"," ",e.jsx("strong",{className:"text-white",children:"5 cards of the same fruit"})," ","wins the game instantly."]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl md:text-2xl font-bold text-[#f1f5f9] mb-6 flex items-center gap-3 font-serif",children:[e.jsx(pe,{className:"text-emerald-400",size:24})," How to Play"]}),e.jsxs("ul",{className:"space-y-4 text-slate-300 text-lg",children:[e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"bg-orange-500 text-black w-8 h-8 rounded-full flex items-center justify-center font-bold shrink-0 mt-1",children:"1"}),e.jsx("div",{children:"Everyone starts with a hand of 5 random fruit cards."})]}),e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"bg-orange-500 text-black w-8 h-8 rounded-full flex items-center justify-center font-bold shrink-0 mt-1",children:"2"}),e.jsxs("div",{children:["On your turn, select ",e.jsx("strong",{children:"ONE card"})," to pass to the player on your left."]})]}),e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"bg-orange-500 text-black w-8 h-8 rounded-full flex items-center justify-center font-bold shrink-0 mt-1",children:"3"}),e.jsx("div",{children:"The game continues in a circle until someone has a full set of 5 matching fruits!"})]})]})]})]}),e.jsx("div",{className:"p-6 bg-black/40 border-t border-orange-500/30 text-center",children:e.jsx(X,{onClick:a,className:"w-full md:w-auto px-12 text-lg",children:"Enter Market"})})]})}),lt=({winnerName:a,isMe:d,onRestart:i,isHost:c,onReturnToLobby:o,roomId:x,userId:t,players:I,readyPlayers:m=[]})=>{const[L,R]=f.useState(!1);f.useEffect(()=>{m.includes(t)&&R(!0)},[m,t]);const b=async()=>{R(!0),await C(g(p,"artifacts",y,"public","data","rooms",x),{readyPlayers:W(t)})},j=I.filter(S=>!S.isBot).length-1,E=m.length,z=j<=0||E>=j;return e.jsx("div",{className:"fixed inset-0 top-14 bg-black/90 z-150 flex items-center justify-center p-4 animate-in fade-in duration-500 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-[#1e293b] rounded-xl p-8 max-w-md w-full text-center relative overflow-hidden shadow-2xl border-2 border-orange-500",children:[e.jsx("div",{className:"absolute inset-0 bg-linear-to-b from-orange-900/20 to-black opacity-50"}),e.jsx(be,{className:"w-24 h-24 mx-auto text-orange-500 mb-4 animate-bounce drop-shadow-[0_0_15px_rgba(249,115,22,0.5)]"}),e.jsx("h2",{className:"text-4xl font-serif font-black text-white mb-2 tracking-wide",children:d?"YOU WON!":`${a} WINS!`}),e.jsx("p",{className:"text-slate-300 mb-8 text-lg",children:"Cornered the market with 5 matching fruits!"}),c?e.jsxs("div",{className:"flex flex-col gap-3 relative z-10",children:[e.jsx("div",{className:"text-sm text-slate-400 mb-2 font-mono",children:z?"All traders are ready!":`Waiting for traders... (${E}/${j})`}),e.jsxs(X,{onClick:i,disabled:!z,variant:"success",className:"w-full text-lg",children:[e.jsx(Ke,{fill:"currentColor",size:20})," Play Again"]}),e.jsxs("button",{onClick:o,disabled:!z,className:"w-full py-3 rounded-lg font-bold transition-all bg-slate-700 hover:bg-slate-600 text-white flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ye,{size:20})," Return to Lobby"]})]}):e.jsx("div",{className:"relative z-10 space-y-4",children:L?e.jsxs("div",{className:"flex flex-col items-center gap-2 text-emerald-500 font-bold bg-emerald-900/20 p-3 rounded-lg border border-emerald-500/30",children:[e.jsx(Xe,{size:24}),e.jsx("span",{children:"You are ready!"}),e.jsx("span",{className:"text-slate-400 text-xs font-normal",children:"Waiting for host..."})]}):e.jsxs("button",{onClick:b,className:"w-full py-3 rounded-lg font-bold transition-all bg-emerald-600 hover:bg-emerald-500 text-white flex items-center justify-center gap-2 shadow-lg shadow-emerald-900/20 animate-pulse",children:[e.jsx(V,{size:20})," Ready for Next Game"]})})]})})},ot=({logs:a,onClose:d})=>e.jsx("div",{className:"fixed top-16 right-4 w-64 max-h-60 bg-gray-900/95 border border-gray-700 rounded-xl z-155 overflow-y-auto p-2 shadow-2xl",children:e.jsxs("div",{className:"bg-[#1e293b] w-full md:max-w-md h-[60vh] rounded-xl flex flex-col border border-orange-500 shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-orange-500/30 flex justify-between items-center bg-black/20",children:[e.jsxs("h3",{className:"text-orange-500 font-serif font-bold text-xl flex items-center gap-2",children:[e.jsx(ge,{size:20})," Market Ledger"]}),e.jsx("button",{onClick:d,className:"p-1.5 hover:bg-white/10 rounded-full transition-colors text-slate-400",children:e.jsx(he,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 bg-[#0f172a]",children:[...a].reverse().map((i,c)=>e.jsx("div",{className:`text-xs md:text-sm p-3 rounded-lg border-l-4 shadow-sm ${i.type==="win"?"bg-yellow-900/20 border-yellow-500 text-yellow-200":i.type==="action"?"bg-slate-800 border-slate-500 text-slate-300":"bg-slate-800 border-slate-600 text-slate-400"}`,children:i.text},c))})]})});function it(){const[a,d]=f.useState(null),[i,c]=f.useState("menu"),[o,x]=f.useState(()=>localStorage.getItem("fs_roomId")||null),[t,I]=f.useState(null),[m,L]=f.useState(""),[R,b]=f.useState(""),[j,E]=f.useState(null),[z,S]=f.useState(!1),[O,q]=f.useState(!1),[Q,w]=f.useState(!1),[we,Z]=f.useState(!1),[ee,te]=f.useState(!1),[v,ve]=f.useState(()=>localStorage.getItem("gameHub_playerName")||"");if(f.useEffect(()=>{v&&localStorage.setItem("gameHub_playerName",v)},[v]),f.useEffect(()=>{(async()=>typeof __initial_auth_token<"u"&&__initial_auth_token?await $e(U,__initial_auth_token):await Te(U))();const l=Pe(U,n=>d(n));return()=>l()},[]),f.useEffect(()=>{o?localStorage.setItem("fs_roomId",o):localStorage.removeItem("fs_roomId")},[o]),f.useEffect(()=>{if(!o||!a)return;const s=g(p,"artifacts",y,"public","data","rooms",o),l=le(s,n=>{if(n.exists()){const r=n.data();if(!r.players.some(h=>h.id===a.uid)){x(null),c("menu"),b("The Market has closed or you were removed.");return}I(r),r.status==="playing"||r.status==="finished"?c("game"):c("lobby")}else x(null),c("menu"),b("Market closed by the Master.")});return()=>l()},[o,a]),f.useEffect(()=>{if(!t||t.status!=="playing"||!a||t.hostId!==a.uid)return;const s=t.players[t.turnIndex];if(s.isBot){const l=setTimeout(()=>{const n=rt(s.hand);ae(n)},1500);return()=>clearTimeout(l)}},[t,a]),f.useEffect(()=>{const s=le(g(p,"game_hub_settings","config"),l=>{l.exists()&&(l.data()[et]?.maintenance?Z(!0):Z(!1))});return()=>s()},[]),we)return e.jsxs("div",{className:"min-h-screen bg-gray-950 flex flex-col items-center justify-center text-white p-4 text-center",children:[e.jsx(ue,{}),e.jsxs("div",{className:"bg-orange-500/10 p-8 rounded-2xl border border-orange-500/30",children:[e.jsx(Ae,{size:64,className:"text-orange-500 mx-auto mb-4 animate-bounce"}),e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Under Maintenance"}),e.jsx("p",{className:"text-gray-400",children:"Market closed for cleaning. Fresh shipment arriving soon."})]}),e.jsx("div",{className:"h-8"}),e.jsx("a",{href:"/rawfids-gamehub/",children:e.jsx("div",{className:"flex items-center justify-center gap-3 mb-2",children:e.jsx("div",{className:"text-center pb-12 animate-pulse",children:e.jsxs("div",{className:"inline-flex items-center gap-3 px-8 py-4 bg-slate-900/50 rounded-full border border-indigo-500/20 text-indigo-300 font-bold tracking-widest text-sm uppercase backdrop-blur-sm",children:[e.jsx(oe,{size:16})," Visit Gamehub...Try our other releases..."," ",e.jsx(oe,{size:16})]})})})}),e.jsx(D,{})]});const Ne=async()=>{if(!v.trim())return b("Please enter your name.");const s="123456789ABCDEFGHIJKLMNPQRSTUVWXYZ";let l="";for(let n=0;n<6;n++)l+=s.charAt(Math.floor(Math.random()*s.length));await Le(g(p,"artifacts",y,"public","data","rooms",l),{hostId:a.uid,status:"lobby",players:[{id:a.uid,name:v,hand:[],ready:!0,isBot:!1}],maxPlayers:4,turnIndex:0,logs:[],readyPlayers:[]}),x(l)},ke=async()=>{if(!v.trim()||!m.trim())return b("Name and Room Code required.");const s=m.toUpperCase(),l=g(p,"artifacts",y,"public","data","rooms",s);try{const n=await ie(l);if(!n.exists())return b("Room not found.");const r=n.data();if(r.status!=="lobby")return b("Game already started.");if(r.players.length>=r.maxPlayers)return b("Room full.");r.players.find(h=>h.id===a.uid)||await C(l,{players:W({id:a.uid,name:v,hand:[],ready:!0,isBot:!1})}),x(s)}catch(n){console.error(n),b("Error joining room.")}},Ce=()=>{const s=o,l=()=>{te(!0),setTimeout(()=>te(!1),2e3),triggerFeedback&&triggerFeedback("neutral","COPIED!","",V)};try{navigator.clipboard.writeText(s),l()}catch{const r=document.createElement("textarea");r.value=s,document.body.appendChild(r),r.select(),document.execCommand("copy"),document.body.removeChild(r),l()}},se=async()=>{if(!t)return;let s=[...t.players];const l=t.maxPlayers;if(s.length<l){const u=l-s.length;for(let h=0;h<u;h++)s.push({id:`BOT-${Math.random().toString(36).substr(2,9)}`,name:`Bot ${h+1}`,hand:[],ready:!0,isBot:!0})}const n=s.length,r=at(n);s=s.map(u=>({...u,hand:r.splice(0,5)})),await C(g(p,"artifacts",y,"public","data","rooms",o),{status:"playing",players:s,turnIndex:0,winnerId:null,logs:[{text:"Market Opened!",type:"neutral"}],readyPlayers:[]})},ae=async s=>{if(!t)return;const l=t.turnIndex,n=(l+1)%t.players.length,r=JSON.parse(JSON.stringify(t.players));if(r[l].hand[s]){const k=r[l].hand.splice(s,1)[0];r[n].hand.push(k)}else{const k=r[l].hand.pop();k&&r[n].hand.push(k)}let u=null,h=null;r.forEach(k=>{const H={};k.hand.forEach($=>{H[$.type]=(H[$.type]||0)+1}),Object.values(H).forEach($=>{$>=5&&(u=k.id,h=k.name)})});const N={players:r,selectedCardIndex:null},G=r[l].name,F=r[n].name,ne=[...t.logs,{text:`${G} passed to ${F}.`,type:"action"}];u?(N.status="finished",N.winnerId=u,ne.push({text:`${h} CORNERED THE MARKET!`,type:"win"})):N.turnIndex=n,N.logs=ne.slice(-10),await C(g(p,"artifacts",y,"public","data","rooms",o),N),E(null)},Ie=()=>{j!==null&&ae(j)},re=async()=>{if(!(!o||!a)){try{const s=g(p,"artifacts",y,"public","data","rooms",o),l=await ie(s);if(l.exists()){const n=l.data();if(n.hostId===a.uid)await Oe(s);else if(n.status==="lobby"){const u=n.players.filter(h=>h.id!==a.uid);await C(s,{players:u})}else await ze(s,n)}}catch(s){console.error(s)}x(null),c("menu"),w(!1)}},ze=async(s,l)=>{await C(s,{status:"finished",players:l.players.filter(n=>n.id!==a.uid),logs:W({text:`${l.players.find(n=>n.id===a.uid)?.name} left the market. Market Closed.`,type:"win"})})},B=async()=>{!t||t.hostId!==a.uid||(await C(g(p,"artifacts",y,"public","data","rooms",o),{status:"lobby",turnIndex:0,winnerId:null,logs:[],readyPlayers:[],players:t.players.map(s=>({...s,hand:[],ready:!0}))}),w(!1))},_=t?.players.findIndex(s=>s.id===a?.uid),P=_>=0?t.players[_]:null,A=t?.turnIndex===_,Se=()=>{if(!t||_===-1)return[];const s=t.players.length,l=[];for(let n=1;n<s;n++){const r=(_+n)%s;l.push({...t.players[r],realIndex:r})}return l};if(!a)return e.jsx("div",{className:"min-h-screen bg-zinc-950 flex items-center justify-center text-orange-500 animate-pulse",children:"Openning stall..."});if(o&&!t&&!R)return e.jsxs("div",{className:"min-h-screen bg-zinc-950 flex flex-col items-center justify-center text-white p-4",children:[e.jsx(T,{}),e.jsxs("div",{className:"bg-zinc-900/80 backdrop-blur p-8 rounded-2xl border border-zinc-700 shadow-2xl flex flex-col items-center gap-4 animate-in fade-in zoom-in duration-300",children:[e.jsx(Ge,{size:48,className:"text-orange-500 animate-spin"}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Reconnecting..."}),e.jsx("p",{className:"text-zinc-400 text-sm",children:"Resuming your session"})]})]})]});if(i==="menu")return e.jsxs("div",{className:"min-h-screen bg-gray-950 text-white flex flex-col relative overflow-hidden font-sans selection:bg-orange-500 selection:text-black",children:[z&&e.jsx(Y,{onClose:()=>S(!1)}),e.jsx(T,{}),e.jsx("nav",{className:"absolute top-0 left-0 w-full p-4 z-50",children:e.jsxs("a",{href:"/rawfids-gamehub/",className:`flex items-center gap-2 text-orange-800 rounded-lg 
			font-bold shadow-md hover:text-orange-400 transition-colors w-fit animate-pulse`,children:[e.jsx(Fe,{}),e.jsx("span",{children:"Back to Gamehub"})]})}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center w-full z-10 px-4",children:[e.jsxs("div",{className:"z-10 text-center mb-10",children:[e.jsx(M,{size:64,className:"text-orange-500 mx-auto mb-4 animate-bounce drop-shadow-[0_0_15px_rgba(249,115,22,0.5)]"}),e.jsx("h1",{className:"text-5xl md:text-7xl font-black text-transparent bg-clip-text bg-linear-to-b from-orange-300 to-orange-600 font-serif tracking-widest drop-shadow-md",children:"FRUIT SELLER"}),e.jsx("p",{className:"text-gray-400 tracking-[0.3em] uppercase mt-2",children:"The Juicy Trading Game"})]}),e.jsxs("div",{className:"bg-gray-900/80 backdrop-blur border border-gray-700 p-8 rounded-2xl w-full max-w-md shadow-2xl animate-in slide-in-from-bottom-10 duration-700 delay-100",children:[R&&e.jsxs("div",{className:"bg-red-900/50 text-red-200 p-2 mb-4 rounded text-center text-sm border border-red-800 flex items-center justify-center gap-2",children:[e.jsx(De,{size:16})," ",R]}),e.jsx("input",{className:"w-full bg-black/50 border border-gray-600 p-3 rounded mb-4 text-white placeholder-gray-500 focus:border-orange-500 outline-none transition-colors",placeholder:"Trader Name",value:v,onChange:s=>ve(s.target.value)}),e.jsxs("button",{onClick:Ne,className:"w-full bg-linear-to-r from-orange-700 to-orange-600 hover:from-orange-600 hover:to-orange-500 p-4 rounded font-bold mb-4 flex items-center justify-center gap-2 border border-orange-500/30 shadow-[0_0_15px_rgba(249,115,22,0.2)] transition-all",children:[e.jsx(me,{size:20})," Open New Stall"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mb-4",children:[e.jsx("input",{className:"w-full sm:flex-1 bg-black/50 border border-gray-600 p-3 rounded text-white placeholder-gray-500 uppercase font-mono tracking-wider focus:border-orange-500 outline-none",placeholder:"ROOM CODE",value:m,onChange:s=>L(s.target.value.toUpperCase())}),e.jsx("button",{onClick:ke,className:"w-full sm:w-auto bg-gray-800 hover:bg-gray-700 border border-gray-600 px-6 py-3 rounded font-bold transition-colors",children:"Join"})]}),e.jsxs("button",{onClick:()=>S(!0),className:"w-full text-sm text-gray-400 hover:text-white flex items-center justify-center gap-2 py-2",children:[e.jsx(de,{size:16})," Market Rules"]})]})]}),e.jsx("div",{className:"z-10 w-full bg-transparent"}),e.jsxs("div",{className:"absolute bottom-4 w-full text-slate-600 text-xs text-center z-50",children:["Developed by ",e.jsx("strong",{children:"RAWFID K SHUVO"}),". Visit"," ",e.jsx("a",{href:"/rawfids-gamehub/",rel:"noopener noreferrer",className:"text-orange-500 underline hover:text-orange-600 relative z-50 cursor-pointer",children:"GAMEHUB"})," ","for more games."]})]});if(i==="lobby"&&t){const s=t.hostId===a.uid,l=t.maxPlayers-t.players.length;return e.jsxs("div",{className:"min-h-screen bg-gray-950 text-white flex flex-col items-center justify-center p-6 relative",children:[e.jsx(T,{}),e.jsx(ue,{}),z&&e.jsx(Y,{onClose:()=>S(!1)}),Q&&e.jsx(fe,{onCancel:()=>w(!1),onConfirmLeave:re,onConfirmLobby:()=>{B(),w(!1)},isHost:s,inGame:!1}),e.jsxs("div",{className:"z-10 w-full max-w-lg bg-gray-800/90 p-8 rounded-2xl border border-gray-700 shadow-2xl mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8 border-b border-gray-700 pb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg md:text-xl text-orange-500 font-bold uppercase",children:"Fruit Stall"}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsx("div",{className:"text-2xl md:text-3xl font-mono text-white font-black",children:o}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:Ce,className:"p-2 hover:bg-white/10 rounded-full transition-colors text-gray-400 hover:text-white",children:ee?e.jsx(V,{size:16,className:"text-green-500"}):e.jsx(He,{size:16})}),ee&&e.jsx("div",{className:"absolute left-full ml-2 top-1/2 -translate-y-1/2 bg-orange-500 text-black text-xs font-bold px-2 py-1 rounded shadow-lg animate-fade-in-up whitespace-nowrap",children:"Copied!"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[e.jsx(ce,{size:16})," ",t.players.length,"/",t.maxPlayers]}),e.jsx("button",{onClick:()=>w(!0),className:"p-2 bg-red-900/50 hover:bg-red-900 rounded text-red-300",title:"Leave Room",children:e.jsx(J,{size:16})})]})]}),e.jsxs("div",{className:"space-y-3 mb-8",children:[t.players.map(n=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-900 p-4 rounded border border-gray-700",children:[e.jsxs("span",{className:"font-bold text-orange-500 flex items-center gap-2",children:[n.id===t.hostId&&e.jsx(be,{size:14,className:"text-orange-500"})," ",n.name]}),n.id===a.uid&&e.jsx("span",{className:"text-xs bg-gray-700 px-2 py-1 rounded",children:"You"})]},n.id)),Array(l).fill(0).map((n,r)=>e.jsxs("div",{className:"p-4 border border-dashed border-gray-700 rounded bg-gray-900/50 flex items-center gap-2 text-gray-500",children:[e.jsx(xe,{size:16}),e.jsx("span",{className:"italic text-sm",children:"Automated Trader will join..."})]},r))]}),s&&e.jsxs("div",{className:"flex justify-end items-center mb-4",children:[e.jsx("span",{className:"text-sm text-gray-400 mr-2",children:"Max Players:"}),e.jsxs("select",{className:"bg-gray-700 border border-gray-600 rounded p-1 text-white font-bold outline-none text-sm",value:t.maxPlayers,onChange:n=>C(g(p,"artifacts",y,"public","data","rooms",o),{maxPlayers:parseInt(n.target.value)}),children:[e.jsx("option",{value:4,children:"4"}),e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:6,children:"6"})]})]}),e.jsx("div",{className:"flex flex-col gap-3",children:s?e.jsxs("button",{onClick:se,className:"w-full py-4 rounded-xl font-bold text-lg shadow-lg transition-all bg-emerald-700 hover:bg-emerald-600 text-white shadow-emerald-900/30",children:["Open Market ",l>0&&"(+ Bots)"]}):e.jsx("div",{className:"text-center text-orange-500/80 font-serif mb-2",children:"Waiting for Host to start..."})})]}),e.jsx(D,{})]})}if(i==="game"&&P){const s=Se(),l=P.hand.map((r,u)=>({...r,originalIndex:u})).sort((r,u)=>r.type.localeCompare(u.type)),n=t.hostId===a.uid;return e.jsxs("div",{className:"min-h-screen bg-slate-950 text-white flex flex-col relative overflow-hidden select-none",children:[e.jsx(T,{}),z&&e.jsx(Y,{onClose:()=>S(!1)}),O&&e.jsx(ot,{logs:t.logs,onClose:()=>q(!1)}),Q&&e.jsx(fe,{onCancel:()=>w(!1),onConfirmLeave:re,onConfirmLobby:()=>{B(),w(!1)},isHost:n,inGame:!0}),t.winnerId&&e.jsx(lt,{winnerName:t.players.find(r=>r.id===t.winnerId)?.name,isMe:t.winnerId===a.uid,isHost:t.hostId===a.uid,onRestart:se,onReturnToLobby:B,roomId:o,userId:a.uid,players:t.players,readyPlayers:t.readyPlayers||[]}),e.jsxs("div",{className:"fixed top-0 left-0 right-0 bg-[#1e293b] p-2 md:p-4 flex justify-between items-center z-160 shadow-md border-b border-orange-500/30 h-14 md:h-16",children:[e.jsxs("div",{className:"font-bold text-orange-500 flex items-center gap-2 text-sm md:text-base font-serif truncate",children:[e.jsx(me,{size:18})," Fruit Market"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>q(!O),className:`p-2 rounded-full ${O?"bg-orange-900 text-orange-400":"text-gray-400 hover:bg-gray-800"}`,children:e.jsx(ge,{size:20})}),e.jsx("button",{onClick:()=>S(!0),className:"p-2 hover:bg-white/10 rounded transition-colors text-slate-300",children:e.jsx(de,{size:20})}),e.jsx("button",{onClick:()=>w(!0),className:"p-2 hover:bg-white/10 rounded transition-colors text-slate-300",children:e.jsx(J,{size:20})})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col pt-24 pb-4 h-screen",children:[e.jsxs("div",{className:"flex-1 flex flex-col relative",children:[e.jsx("div",{className:"flex justify-center flex-wrap gap-4 p-2 z-10 min-h-[120px]",children:s.map(r=>{const u=t.turnIndex===r.realIndex;return e.jsx("div",{className:`flex flex-col items-center transition-all duration-300 ${u?"scale-105 opacity-100":"opacity-70 scale-95"}`,children:e.jsxs("div",{className:`relative rounded-lg bg-[#0f172a] border-2 p-2 flex flex-col items-center shadow-lg w-20 md:w-24
                            ${u?"border-orange-500 shadow-orange-500/30":"border-slate-700"}`,children:[e.jsxs("div",{className:"relative",children:[r.isBot?e.jsx(xe,{className:"text-slate-400"}):e.jsx(ce,{className:"text-slate-400"}),e.jsx("div",{className:"absolute -top-2 -right-2 bg-red-600 text-white text-[10px] font-bold w-5 h-5 rounded-full flex items-center justify-center border border-white",children:r.hand.length})]}),e.jsx("div",{className:"text-[10px] font-bold text-slate-300 mt-1 truncate w-full text-center",children:r.name}),u&&e.jsx("div",{className:"absolute -top-3 bg-orange-500 text-black text-[8px] font-bold px-2 py-0.5 rounded-full animate-bounce",children:"PLAYING"})]})},r.id)})}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center z-0 relative min-h-[150px]",children:[t.logs.length>0&&e.jsx("div",{className:"mb-4 px-4 py-1 rounded-full bg-black/40 backdrop-blur-sm text-orange-400 border border-orange-500/20 text-xs md:text-sm font-serif",children:t.logs[t.logs.length-1].text}),e.jsx("div",{className:"h-16 flex items-center justify-center",children:A&&j!==null?e.jsxs(X,{onClick:Ie,className:"animate-in zoom-in px-8 py-3 shadow-[0_0_30px_rgba(249,115,22,0.4)] text-lg",children:["Pass Card ",e.jsx(pe,{size:20,className:"ml-2"})]}):A?e.jsxs("div",{className:"animate-pulse flex flex-col items-center",children:[e.jsx("h2",{className:"text-3xl font-black text-orange-500 drop-shadow-md tracking-wider",children:"YOUR TURN"}),e.jsx("span",{className:"text-slate-400 text-sm",children:"Select a card from your hand"})]}):e.jsx("div",{className:"text-slate-500 text-sm italic",children:"Waiting for trades..."})})]})]}),e.jsxs("div",{className:"mt-auto flex flex-col items-center w-full max-w-5xl mx-auto z-20",children:[e.jsxs("div",{className:"bg-[#1e293b] border border-orange-500/30 rounded-t-lg px-6 py-1 shadow-lg mb-[-10px] relative z-0",children:[e.jsx("span",{className:"text-slate-400 text-[10px] font-bold uppercase mr-2",children:"YOU"}),e.jsx("span",{className:"text-orange-500 font-serif font-bold",children:P.name})]}),e.jsxs("div",{className:"w-full flex justify-center items-end h-48 md:h-64 pb-2 px-4 overflow-x-auto no-scrollbar",children:[" ",e.jsx("div",{className:"flex justify-center items-end -space-x-8 md:-space-x-12 hover:-space-x-3 transition-all duration-300 w-auto",style:{paddingBottom:"10px"},children:l.map((r,u)=>{const h=A&&j===r.originalIndex,N=P.hand.length,G=(u-(N-1)/2)*(window.innerWidth<768?2:4),F=h?-40:Math.abs(u-(N-1)/2)*(window.innerWidth<768?2:5);return e.jsx("div",{style:{zIndex:h?50:u,transform:`rotate(${G}deg) translateY(${F}px)`,transformOrigin:"bottom center"},className:"transition-all duration-300 cursor-pointer hover:z-40 shrink-0",children:e.jsx(nt,{type:r.type,highlight:h,onClick:()=>A&&E(r.originalIndex)})},r.id)})})]})]})]}),e.jsx(D,{})]})}return null}Be.createRoot(document.getElementById("root")).render(e.jsx(f.StrictMode,{children:e.jsx(it,{})}));
