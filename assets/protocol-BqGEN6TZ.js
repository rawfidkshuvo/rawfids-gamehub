import{c as P,i as Ge,g as He,a as Fe,r as c,e as Ue,o as ie,d as f,j as e,H as Be,S as de,n as We,s as Ke,h as Ye,p as qe,u as y,q as A,t as Xe,X as pe,m as Ze}from"./x-vdu6PxPT.js";import{L as Je,S as Qe,B as U,C as z,a as et,b as B,P as tt}from"./step-back-D7uqsBfy.js";import{S as ye}from"./server-M-I2gxY8.js";import{Z as je}from"./zap-BEeOHqdt.js";import{U as ce}from"./user-hi-jrCL7.js";import{C as W}from"./crown-DhFWzZA3.js";import{T as st}from"./trash-2-CC3Hg-Aa.js";import{T as xe}from"./triangle-alert-CO8fZ1I9.js";import{H as ve}from"./history-r3RmdCN7.js";import{C as at}from"./circle-x-CjDkV9cY.js";import{E as we}from"./eye-ByZgRM3i.js";import{C as rt}from"./check-CGP4nRzB.js";import{S as Ne}from"./shield-YRjbg8Vk.js";import{R as Se}from"./rotate-ccw-B8nxxfV1.js";import{H as ke}from"./house-BdFnrmDF.js";import{T as Ce}from"./terminal-CyFkatav.js";import{L as ot}from"./lock-CXckOrBe.js";import{S as nt}from"./sword-B_tdzrAl.js";import{C as lt}from"./crosshair-S3deBiGz.js";const it=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]],dt=P("lock-open",it);const ct=[["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z",key:"m61m77"}],["path",{d:"M17 14V2",key:"8ymqnk"}]],me=P("thumbs-down",ct);const xt=[["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}],["path",{d:"M7 10v12",key:"1qc93n"}]],ue=P("thumbs-up",xt);const mt=[["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}],["path",{d:"M5 7c0-1.1.9-2 2-2h10a2 2 0 0 1 2 2v12H5V7Z",key:"1ezoue"}],["path",{d:"M22 19H2",key:"nuriw5"}]],Ie=P("vote",mt),ut="/rawfids-gamehub/assets/protocol_cover-CfPvCidh.png",gt={apiKey:"AIzaSyBjIjK53vVJW1y5RaqEFGSFp0ECVDBEe1o",authDomain:"game-hub-ff8aa.firebaseapp.com",projectId:"game-hub-ff8aa",storageBucket:"game-hub-ff8aa.firebasestorage.app",messagingSenderId:"586559578902",appId:"1:586559578902:web:91da4fa4ace038d16aa637"},Me=Ge(gt),H=He(Me),h=Fe(Me),b=typeof __app_id<"u"?__app_id:"protocol-game",ft="8",_={5:[2,3,2,3,3],6:[2,3,4,3,4],7:[2,3,3,4,4],8:[3,4,4,5,5],9:[3,4,4,5,5],10:[3,4,4,5,5]},ht={5:2,6:2,7:3,8:3,9:3,10:4},ge={1:W,2:Ne,3:lt,4:nt,5:we,6:je,7:Ie,8:ot,9:dt,10:ye},R=({isShaking:o})=>e.jsxs("div",{className:`absolute inset-0 overflow-hidden pointer-events-none z-0 ${o?"animate-shake bg-red-900/20":""}`,children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-full bg-[radial-gradient(ellipse_at_top,var(--tw-gradient-stops))] from-slate-900/40 via-gray-950 to-black"}),e.jsx("div",{className:"absolute top-0 left-0 w-full h-full opacity-10",children:[...Array(20)].map((v,u)=>{const x=Object.keys(ge),i=x[u%x.length],w=ge[i];return e.jsx("div",{className:"absolute animate-float text-white/60",style:{left:`${Math.random()*100}%`,top:`${Math.random()*100}%`,animationDuration:`${10+Math.random()*20}s`,transform:`scale(${.5+Math.random()})`},children:e.jsx(w,{size:32})},u)})}),e.jsx("style",{children:`
      @keyframes float {
        0%, 100% { transform: translateY(0) rotate(0deg); }
        50% { transform: translateY(-20px) rotate(10deg); }
      }
      .animate-float { animation: float infinite ease-in-out; }
      
      @keyframes shake {
        0%, 100% { transform: translateX(0); }
        10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
        20%, 40%, 60%, 80% { transform: translateX(5px); }
      }
      .animate-shake { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
    `})]}),F=()=>e.jsxs("div",{className:"flex items-center justify-center gap-1 opacity-40 mt-auto pb-2 pt-2 relative z-10",children:[e.jsx(Ce,{size:12,className:"text-cyan-500"}),e.jsx("span",{className:"text-[10px] font-black tracking-widest text-cyan-500 uppercase",children:"PROTOCOL"})]}),fe=()=>e.jsxs("div",{className:"flex items-center justify-center gap-1 opacity-40 mt-auto pb-2 pt-2 relative z-10",children:[e.jsx(Ce,{size:22,className:"text-cyan-500"}),e.jsx("span",{className:"text-[20px] font-black tracking-widest text-cyan-500 uppercase",children:"PROTOCOL"})]}),he=({onConfirmLeave:o,onConfirmLobby:v,onCancel:u,isHost:x,inGame:i})=>e.jsx("div",{className:"fixed inset-0 bg-black/90 z-200 flex items-center justify-center p-4 animate-in fade-in",children:e.jsxs("div",{className:"bg-gray-800 rounded-xl border border-gray-700 p-6 max-w-sm w-full text-center shadow-2xl",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Abort Protocol?"}),e.jsx("p",{className:"text-gray-400 mb-6 text-sm",children:x?"WARNING: As Admin, terminating connection will shut down the server for all agents.":i?"Leaving now will compromise the mission for everyone!":"Disconnecting from the secure server."}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("button",{onClick:u,className:"bg-gray-700 hover:bg-gray-600 text-white py-3 rounded font-bold transition-colors",children:"Stay Connected"}),i&&x&&e.jsxs("button",{onClick:v,className:"py-3 rounded font-bold transition-colors flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-500 text-white",children:[e.jsx(ke,{size:18})," Return Unit to Lobby"]}),e.jsxs("button",{onClick:o,className:"bg-red-600 hover:bg-red-500 text-white py-3 rounded font-bold transition-colors flex items-center justify-center gap-2",children:[e.jsx(B,{size:18})," ",x?"Shut Down Server":"Disconnect"]})]})]})}),bt=({logs:o,onClose:v})=>e.jsx("div",{className:"fixed top-16 right-4 w-64 max-h-60 bg-gray-900/95 border border-gray-700 rounded-xl z-155 overflow-y-auto p-2 shadow-2xl",children:e.jsxs("div",{className:"bg-gray-800 w-full md:max-w-md h-full md:h-[70vh] rounded-none md:rounded-xl flex flex-col border-none md:border border-gray-700 shadow-2xl",children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 flex justify-between items-center bg-gray-800",children:[e.jsxs("h3",{className:"text-white font-bold text-lg flex items-center gap-2",children:[e.jsx(ve,{size:18,className:"text-cyan-400"})," Server Logs"]}),e.jsx("button",{onClick:v,className:"p-2 bg-gray-700 rounded-full hover:bg-gray-600",children:e.jsx(pe,{className:"text-gray-400"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2",children:[...o].reverse().map((u,x)=>e.jsxs("div",{className:`text-xs md:text-sm p-3 rounded border-l-2 ${u.type==="danger"?"bg-red-900/20 border-red-500 text-red-200":u.type==="success"?"bg-green-900/20 border-green-500 text-green-200":u.type==="warning"?"bg-yellow-900/20 border-yellow-500 text-yellow-200":"bg-gray-700/50 border-gray-500 text-gray-300"}`,children:[e.jsxs("span",{className:"opacity-50 mr-2 font-mono",children:["[",new Date(parseInt(u.id)).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"}),"]"]}),u.text]},x))})]})}),be=({onClose:o})=>e.jsx("div",{className:"fixed inset-0 bg-black/95 z-100 flex items-center justify-center p-0 md:p-4 animate-in fade-in",children:e.jsxs("div",{className:"bg-gray-900 md:rounded-2xl w-full max-w-4xl h-full md:h-auto md:max-h-[90vh] overflow-hidden border-none md:border border-cyan-500/30 flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-gray-800 flex justify-between items-center bg-gray-950",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-2 tracking-wider",children:[e.jsx(U,{className:"text-cyan-400"})," Field Manual"]}),e.jsx("button",{onClick:o,className:"p-2 hover:bg-gray-800 rounded-full text-gray-400",children:e.jsx(pe,{})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto text-gray-300 space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-cyan-900/10 p-4 rounded-lg border border-cyan-500/20",children:[e.jsx("h3",{className:"text-xl font-bold text-cyan-400 mb-2",children:"Operatives (Good)"}),e.jsxs("ul",{className:"list-disc pl-5 space-y-2 text-sm",children:[e.jsx("li",{children:"You do NOT know who is who."}),e.jsxs("li",{children:["Goal: Successfully complete ",e.jsx("strong",{children:"3 Missions"}),"."]}),e.jsx("li",{children:"Always vote to Approve trustworthy teams."}),e.jsxs("li",{children:["If on a mission, you MUST play ",e.jsx("strong",{children:"SUCCESS"}),"."]})]})]}),e.jsxs("div",{className:"bg-red-900/10 p-4 rounded-lg border border-red-500/20",children:[e.jsx("h3",{className:"text-xl font-bold text-red-400 mb-2",children:"Moles (Bad)"}),e.jsxs("ul",{className:"list-disc pl-5 space-y-2 text-sm",children:[e.jsx("li",{children:"You know who the other Moles are."}),e.jsxs("li",{children:["Goal: Fail ",e.jsx("strong",{children:"3 Missions"}),"."]}),e.jsx("li",{children:"Deceive Operatives to get on mission teams."}),e.jsxs("li",{children:["If on a mission, you can choose ",e.jsx("strong",{children:"SUCCESS"})," or"," ",e.jsx("strong",{children:"SABOTAGE"}),"."]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-white mb-2",children:"Game Flow"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"1. Proposal:"})," The Leader proposes a team for the current mission."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"2. Voting:"})," Everyone votes to Approve or Reject the team. Majority rules."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"3. Mission:"})," If approved, the team secretly executes the mission. One Sabotage usually fails the mission."]}),e.jsx("p",{className:"text-gray-500 italic",children:"5 failed votes in a row = Immediate Mole Victory."})]})]})]})]})}),pt=({type:o,message:v,subtext:u,icon:x})=>e.jsx("div",{className:"fixed inset-0 z-160 flex items-center justify-center pointer-events-none",children:e.jsxs("div",{className:`
      flex flex-col items-center justify-center p-8 md:p-12 rounded-3xl border-4 shadow-[0_0_50px_rgba(0,0,0,0.8)] 
      transform transition-all animate-in fade-in zoom-in slide-in-from-bottom-10 duration-300
      backdrop-blur-md
      ${o==="success"?"bg-cyan-900/90 border-cyan-500 text-cyan-100":""}
      ${o==="failure"?"bg-red-900/90 border-red-500 text-red-100":""}
      ${o==="neutral"?"bg-gray-800/90 border-gray-500 text-white":""}
    `,children:[x&&e.jsx("div",{className:"mb-4 p-4 bg-black/30 rounded-full border-2 border-white/20",children:e.jsx(x,{size:64,className:"animate-bounce"})}),e.jsx("h2",{className:"text-3xl md:text-5xl font-black uppercase tracking-widest text-center drop-shadow-lg mb-2",children:v}),u&&e.jsx("p",{className:"text-lg md:text-xl font-bold opacity-90 tracking-wide text-center",children:u})]})}),yt=({onStart:o})=>{const[v,u]=c.useState(!1),[x,i]=c.useState(!1),[w,C]=c.useState(!1);return c.useEffect(()=>{C(!0);const D=localStorage.getItem("protocol_roomId");u(!!D);const t=setTimeout(()=>{i(!0)},2e3);return()=>clearTimeout(t)},[]),e.jsxs("div",{className:"fixed inset-0 z-[200] bg-black flex flex-col items-center justify-end pb-20 md:justify-center md:pb-0 font-sans overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 z-0 overflow-hidden",children:[e.jsx("div",{className:`w-full h-full bg-cover bg-center transition-transform duration-[2000ms] ease-out ${w?"scale-100":"scale-130"}`,style:{backgroundImage:`url(${ut})`}}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-transparent to-black/40"})]}),e.jsx("div",{className:"relative z-10 flex flex-col items-center gap-8 animate-in fade-in slide-in-from-bottom-10 duration-1000",children:e.jsx("div",{className:`transform transition-all duration-1000 ease-out ${x?"translate-y-0 opacity-100":"translate-y-20 opacity-0"}`,children:e.jsxs("button",{onClick:o,className:"group relative px-12 py-5 bg-cyan-600/20 hover:bg-cyan-600/40 border border-cyan-500/50 hover:border-cyan-400 text-cyan-300 font-black text-2xl tracking-widest rounded-none transform transition-all hover:scale-105 hover:shadow-[0_0_30px_rgba(34,211,238,0.4)] backdrop-blur-md overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-transparent via-cyan-400/10 to-transparent translate-y-[-100%] animate-[scan_2s_infinite_linear]"}),e.jsx("span",{className:"relative z-10 flex items-center gap-3 animate-pulse",children:v?e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"animate-spin-slow"})," RESUME"]}):e.jsxs(e.Fragment,{children:[e.jsx(tt,{})," PLAY"]})})]})})}),e.jsx("style",{children:`
        @keyframes scan {
          0% { transform: translateY(-100%); }
          100% { transform: translateY(200%); }
        }
      `})]})};function jt(){const[o,v]=c.useState(null),[u,x]=c.useState("splash"),[i,w]=c.useState(""),[C,D]=c.useState(""),[t,Te]=c.useState(null),[K,O]=c.useState(!1),[V,I]=c.useState(""),[Ee,Y]=c.useState(!1),[q,X]=c.useState(!1),[Z,L]=c.useState(!1),[J,M]=c.useState(!1),[$,Q]=c.useState(!1),[E,ee]=c.useState(null),[S,ze]=c.useState(()=>localStorage.getItem("gameHub_playerName")||"");c.useEffect(()=>{S&&localStorage.setItem("gameHub_playerName",S)},[S]),c.useEffect(()=>{(async()=>typeof __initial_auth_token<"u"&&__initial_auth_token?await We(H,__initial_auth_token):await Ke(H))();const s=Ue(H,v);return()=>s()},[]);const Oe=()=>{const a=localStorage.getItem("protocol_roomId");a&&w(a),x("menu")};c.useEffect(()=>{if(!i||!o)return;const a=ie(f(h,"artifacts",b,"public","data","rooms",i),s=>{if(s.exists()){const n=s.data();if(!n.players.some(l=>l.id===o.uid)){w(""),x("menu"),localStorage.removeItem("protocol_roomId"),I("Connection Terminated by Host.");return}Te(n),n.status==="lobby"?x("lobby"):x("game"),n.feedbackTrigger&&n.feedbackTrigger.id!==t?.feedbackTrigger?.id&&(ee(n.feedbackTrigger),setTimeout(()=>ee(null),2500))}else w(""),x("menu"),localStorage.removeItem("protocol_roomId"),I("Room Closed (Host Disconnected).")});return()=>a()},[i,o,t?.feedbackTrigger?.id]),c.useEffect(()=>{const a=ie(f(h,"game_hub_settings","config"),s=>{s.exists()&&s.data()[ft]?.maintenance?Y(!0):Y(!1)});return()=>a()},[]);const Le=async()=>{if(!S.trim())return I("Codename required.");O(!0);const a="123456789ABCDEFGHIJKLMNPQRSTUVWXYZ";let s="";for(let l=0;l<6;l++)s+=a.charAt(Math.floor(Math.random()*a.length));const n={roomId:s,hostId:o.uid,status:"lobby",players:[{id:o.uid,name:S,role:null,isLeader:!1,ready:!0}],logs:[],missionHistory:[null,null,null,null,null],currentMissionIndex:0,failedVoteCount:0,leaderIndex:0,turnState:"IDLE",proposedTeam:[],votes:{},missionMoves:{},feedbackTrigger:null};try{await Ye(f(h,"artifacts",b,"public","data","rooms",s),n),localStorage.setItem("protocol_roomId",s),w(s),x("lobby")}catch{I("Network error.")}O(!1)},Ae=async()=>{if(!C||!S)return I("Code and Name required.");O(!0);try{const a=f(h,"artifacts",b,"public","data","rooms",C),s=await qe(a);if(!s.exists())throw new Error("Room not found.");const n=s.data();if(n.status!=="lobby")throw new Error("Protocol already initiated.");if(n.players.length>=10)throw new Error("Lobby full.");n.players.find(l=>l.id===o.uid)||await y(a,{players:A({id:o.uid,name:S,role:null,isLeader:!1,ready:!0})}),localStorage.setItem("protocol_roomId",C),w(C)}catch(a){I(a.message)}O(!1)},te=async()=>{if(!i)return;const a=f(h,"artifacts",b,"public","data","rooms",i);try{if(t.hostId===o.uid)await Xe(a);else{const s=t.players.filter(n=>n.id!==o.uid);await y(a,{players:s})}}catch(s){console.error(s)}localStorage.removeItem("protocol_roomId"),w(""),x("menu"),M(!1)},_e=async a=>{if(t.hostId!==o.uid)return;const s=t.players.filter(n=>n.id!==a);await y(f(h,"artifacts",b,"public","data","rooms",i),{players:s})},Re=()=>{const a=t.roomId,s=()=>{X(!0),setTimeout(()=>X(!1),2e3),triggerFeedback&&triggerFeedback("neutral","COPIED!","",z)};try{navigator.clipboard.writeText(a),s()}catch{const l=document.createElement("textarea");l.value=a,document.body.appendChild(l),l.select(),document.execCommand("copy"),document.body.removeChild(l),s()}},se=async()=>{if(!t)return;const a=t.players.map(s=>s.id===o.uid?{...s,ready:!s.ready}:s);await y(f(h,"artifacts",b,"public","data","rooms",i),{players:a})},ae=async()=>{if(t.players.length<5)return I("Need 5+ Agents.");const a=[...t.players].sort(()=>Math.random()-.5),s=a.length,n=ht[s]||2,l=Array(s).fill("OPERATIVE");for(let r=0;r<n;r++)l[r]="MOLE";const N=l.sort(()=>Math.random()-.5),d=a.map((r,g)=>({...r,role:N[g],isLeader:g===0,ready:!1}));await y(f(h,"artifacts",b,"public","data","rooms",i),{status:"game",players:d,leaderIndex:0,currentMissionIndex:0,failedVoteCount:0,turnState:"PICKING",proposedTeam:[],votes:{},missionMoves:{},missionHistory:[null,null,null,null,null],logs:[{id:Date.now().toString(),text:"Protocol Initiated. Roles Assigned.",type:"neutral"}]})},Pe=async a=>{if(t.turnState!=="PICKING")return;const s=t.proposedTeam||[],n=_[t.players.length][t.currentMissionIndex];let l;if(s.includes(a))l=s.filter(N=>N!==a);else{if(s.length>=n)return;l=[...s,a]}await y(f(h,"artifacts",b,"public","data","rooms",i),{proposedTeam:l})},De=async()=>{const a=_[t.players.length][t.currentMissionIndex];t.proposedTeam.length===a&&await y(f(h,"artifacts",b,"public","data","rooms",i),{turnState:"VOTING",votes:{},logs:A({id:Date.now().toString(),text:"Team proposed. Voting initiated.",type:"neutral"})})},re=async a=>{const s={...t.votes,[o.uid]:a};if(Object.keys(s).length===t.players.length){const n=Object.values(s).filter(g=>g).length,l=Object.values(s).filter(g=>!g).length,N=n>l;let d={votes:s},r=[{id:Date.now().toString(),text:`Vote Result: ${n} Approves, ${l} Rejects.`,type:N?"success":"danger"}];if(N)d.turnState="MISSION",d.missionMoves={},d.failedVoteCount=0,d.feedbackTrigger={id:Date.now(),type:"success",message:"APPROVED",subtext:"Mission Team is Go"},r.push({id:Date.now()+1,text:"Mission started. Operatives must act.",type:"neutral"});else{const g=t.failedVoteCount+1;if(g>=5)d.status="finished",d.winner="MOLES",d.feedbackTrigger={id:Date.now(),type:"failure",message:"CHAOS",subtext:"Moles Win via Chaos"},r.push({id:Date.now()+1,text:"5 Failed Votes. System Collapse. Moles Win.",type:"danger"});else{const p=(t.leaderIndex+1)%t.players.length,j=t.players[p].id,m=t.players.map(T=>({...T,isLeader:T.id===j}));d.turnState="PICKING",d.proposedTeam=[],d.failedVoteCount=g,d.leaderIndex=p,d.players=m,d.feedbackTrigger={id:Date.now(),type:"failure",message:"REJECTED",subtext:"Leadership Rotates"}}}d.logs=A(...r),await y(f(h,"artifacts",b,"public","data","rooms",i),d)}else await y(f(h,"artifacts",b,"public","data","rooms",i),{votes:s})},oe=async a=>{const s={...t.missionMoves,[o.uid]:a},n=t.proposedTeam.length;if(Object.keys(s).length===n){const l=Object.values(s).filter(k=>k==="SABOTAGE").length,N=t.players.length,d=t.currentMissionIndex,g=N>=7&&d===3?l<2:l===0,p=[...t.missionHistory];p[d]=g;let j=[{id:Date.now().toString(),text:`Mission ${d+1} Report: ${l} Sabotage(s). result: ${g?"SUCCESS":"FAILURE"}`,type:g?"success":"danger"}],m={missionHistory:p,missionMoves:s};const T=p.filter(k=>k===!0).length,G=p.filter(k=>k===!1).length;if(T>=3)m.status="finished",m.winner="OPERATIVES",m.feedbackTrigger={id:Date.now(),type:"success",message:"VICTORY",subtext:"Operatives secured the Protocol"},j.push({id:Date.now()+1,text:"Operatives Win!",type:"success"});else if(G>=3)m.status="finished",m.winner="MOLES",m.feedbackTrigger={id:Date.now(),type:"failure",message:"DEFEAT",subtext:"Moles corrupted the Protocol"},j.push({id:Date.now()+1,text:"Moles Win!",type:"danger"});else{const k=(t.leaderIndex+1)%t.players.length,Ve=t.players[k].id,$e=t.players.map(le=>({...le,isLeader:le.id===Ve}));m.currentMissionIndex=t.currentMissionIndex+1,m.turnState="PICKING",m.proposedTeam=[],m.votes={},m.failedVoteCount=0,m.leaderIndex=k,m.players=$e,m.feedbackTrigger||(m.feedbackTrigger=g?{id:Date.now(),type:"success",message:"SUCCESS",subtext:`${l} Sabotage detected`}:{id:Date.now(),type:"failure",message:"FAILURE",subtext:`${l} Sabotage detected`})}m.logs=A(...j),await y(f(h,"artifacts",b,"public","data","rooms",i),m)}else await y(f(h,"artifacts",b,"public","data","rooms",i),{missionMoves:s})},ne=async()=>{const a=t.players.map(s=>({...s,role:null,isLeader:!1,ready:!0}));await y(f(h,"artifacts",b,"public","data","rooms",i),{status:"lobby",players:a,logs:[],missionHistory:[null,null,null,null,null],currentMissionIndex:0,failedVoteCount:0,votes:{},missionMoves:{},turnState:"IDLE",feedbackTrigger:null,winner:null})};if(Ee)return e.jsxs("div",{className:"min-h-screen bg-gray-950 flex flex-col items-center justify-center text-white p-4 text-center",children:[e.jsx(fe,{}),e.jsxs("div",{className:"bg-orange-500/10 p-8 rounded-2xl border border-orange-500/30",children:[e.jsx(Be,{size:64,className:"text-orange-500 mx-auto mb-4 animate-bounce"}),e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Under Maintenance"}),e.jsx("p",{className:"text-gray-400",children:"System Reboot Initiated. Access denied to all personnel."})]}),e.jsx("div",{className:"h-8"}),e.jsx("a",{href:"/rawfids-gamehub/",children:e.jsx("div",{className:"flex items-center justify-center gap-3 mb-2",children:e.jsx("div",{className:"text-center pb-12 animate-pulse",children:e.jsxs("div",{className:"inline-flex items-center gap-3 px-8 py-4 bg-slate-900/50 rounded-full border border-indigo-500/20 text-indigo-300 font-bold tracking-widest text-sm uppercase backdrop-blur-sm",children:[e.jsx(de,{size:16})," Visit Gamehub...Try our other releases..."," ",e.jsx(de,{size:16})]})})})}),e.jsx(F,{})]});if(!o)return e.jsx("div",{className:"min-h-screen bg-zinc-950 flex items-center justify-center text-cyan-500 animate-pulse",children:"Establishing Secure Connection..."});if(i&&!t&&!V)return e.jsxs("div",{className:"min-h-screen bg-zinc-950 flex flex-col items-center justify-center text-white p-4",children:[e.jsx(R,{}),e.jsxs("div",{className:"bg-zinc-900/80 backdrop-blur p-8 rounded-2xl border border-zinc-700 shadow-2xl flex flex-col items-center gap-4 animate-in fade-in zoom-in duration-300",children:[e.jsx(Je,{size:48,className:"text-cyan-500 animate-spin"}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Reconnecting..."}),e.jsx("p",{className:"text-zinc-400 text-sm",children:"Resuming your session"})]})]})]});if(u==="splash")return e.jsx(yt,{onStart:Oe});if(u==="menu")return e.jsxs("div",{className:"min-h-screen bg-gray-950 text-white flex flex-col items-center justify-center p-4 relative overflow-hidden font-sans",children:[e.jsx(R,{}),e.jsx("nav",{className:"absolute top-0 left-0 w-full p-4 z-50",children:e.jsxs("a",{href:"/rawfids-gamehub/",className:`flex items-center gap-2 text-cyan-800 rounded-lg 
			font-bold shadow-md hover:text-cyan-400 transition-colors w-fit animate-pulse`,children:[e.jsx(Qe,{}),e.jsx("span",{children:"Back to Gamehub"})]})}),Z&&e.jsx(be,{onClose:()=>L(!1)}),e.jsxs("div",{className:"z-10 text-center mb-10",children:[e.jsx(ye,{size:64,className:"text-cyan-500 mx-auto mb-4 animate-bounce drop-shadow-[0_0_15px_rgba(6,182,212,0.5)]"}),e.jsx("h1",{className:"text-5xl md:text-7xl font-black text-transparent bg-clip-text bg-linear-to-b from-cyan-400 to-blue-600 font-serif tracking-widest drop-shadow-md",children:"PROTOCOL"}),e.jsx("p",{className:"text-white-400/60 tracking-[0.3em] uppercase mt-2",children:"Trust No One"})]}),e.jsxs("div",{className:"bg-gray-900/80 backdrop-blur border border-cyan-500/30 p-8 rounded-2xl w-full max-w-md shadow-2xl z-10 animate-in slide-in-from-bottom-10 duration-700 delay-100",children:[V&&e.jsx("div",{className:"bg-red-900/50 text-red-200 p-2 mb-4 rounded text-center text-sm border border-red-800",children:V}),e.jsx("input",{className:"w-full bg-black/50 border border-gray-600 p-3 rounded mb-4 text-white placeholder-gray-500 focus:border-cyan-500 outline-none transition-colors font-mono",placeholder:"CODENAME",value:S,onChange:a=>ze(a.target.value)}),e.jsxs("button",{onClick:Le,disabled:K,className:"w-full bg-linear-to-r from-cyan-700 to-blue-600 hover:from-cyan-600 hover:to-blue-500 p-4 rounded font-bold mb-4 flex items-center justify-center gap-2 border border-cyan-500/30 shadow-[0_0_15px_rgba(6,182,212,0.2)] transition-all",children:[e.jsx(je,{size:20})," Initialize Protocol"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mb-4",children:[e.jsx("input",{className:"w-full sm:flex-1 bg-black/50 border border-gray-600 p-3 rounded text-white placeholder-gray-500 uppercase font-mono tracking-wider focus:border-cyan-500 outline-none",placeholder:"ACCESS CODE",value:C,onChange:a=>D(a.target.value.toUpperCase())}),e.jsx("button",{onClick:Ae,disabled:K,className:"w-full sm:w-auto bg-gray-800 hover:bg-gray-700 border border-gray-600 px-6 py-3 rounded font-bold transition-colors",children:"Enter"})]}),e.jsxs("button",{onClick:()=>L(!0),className:"w-full text-sm text-gray-400 hover:text-white flex items-center justify-center gap-2 py-2",children:[e.jsx(U,{size:16})," Field Manual"]})]}),e.jsxs("div",{className:"absolute bottom-4 text-slate-600 text-xs text-center",children:["Inspired by The Resistance: Avalon. A tribute game.",e.jsx("br",{}),"Developed by ",e.jsx("strong",{children:"RAWFID K SHUVO"}),". Visit"," ",e.jsx("a",{href:"/rawfids-gamehub/",rel:"noopener noreferrer",className:"text-cyan-500 underline hover:text-cyan-600",children:"GAMEHUB"})," ","for more games."]})]});if(u==="lobby"&&t){const a=t.hostId===o.uid;return e.jsxs("div",{className:"min-h-screen bg-gray-950 text-white flex flex-col items-center justify-center p-6 relative",children:[e.jsx(R,{}),e.jsx(fe,{}),J&&e.jsx(he,{onConfirmLeave:te,onCancel:()=>M(!1),isHost:a,inGame:!1}),e.jsxs("div",{className:"z-10 w-full max-w-lg bg-gray-900/90 backdrop-blur p-8 rounded-2xl border border-cyan-900/50 shadow-2xl mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8 border-b border-gray-700 pb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg md:text-xl text-cyan-500 font-bold uppercase",children:"Sabotage Code"}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsx("div",{className:"text-2xl md:text-3xl font-mono text-white font-black",children:i}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:Re,className:"p-2 hover:bg-white/10 rounded-full transition-colors text-gray-400 hover:text-white",children:q?e.jsx(z,{size:16,className:"text-green-500"}):e.jsx(et,{size:16})}),q&&e.jsx("div",{className:"absolute left-full ml-2 top-1/2 -translate-y-1/2 bg-cyan-500 text-black text-xs font-bold px-2 py-1 rounded shadow-lg animate-fade-in-up whitespace-nowrap",children:"Copied!"})]})]})]}),e.jsx("button",{onClick:()=>M(!0),className:"p-2 bg-red-900/30 hover:bg-red-900/50 rounded text-red-300",children:e.jsx(B,{size:16})})]}),e.jsxs("div",{className:"bg-black/20 rounded-xl p-4 mb-8 border border-gray-800",children:[e.jsx("h3",{className:"text-gray-500 text-xs uppercase tracking-wider mb-4 flex justify-between",children:e.jsxs("span",{children:["Units (",t.players.length,")"]})}),e.jsxs("div",{className:"space-y-2",children:[t.players.map(s=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-800/50 p-3 rounded border border-gray-700/50",children:[e.jsxs("span",{className:`font-bold flex items-center gap-2 ${s.id===o.uid?"text-cyan-400":"text-gray-300"}`,children:[e.jsx(ce,{size:14})," ",s.name," ",s.id===t.hostId&&e.jsx(W,{size:14,className:"text-yellow-500"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-green-500 text-xs flex items-center gap-1",children:[e.jsx(z,{size:12})," Connected"]}),a&&s.id!==o.uid&&e.jsx("button",{onClick:()=>_e(s.id),className:"text-gray-500 hover:text-red-500 transition-colors",title:"Kick Unit",children:e.jsx(st,{size:14})})]})]},s.id)),t.players.length<5&&e.jsx("div",{className:"text-center text-gray-500 italic text-sm py-2",children:"Waiting for 5+ units..."})]})]}),a?e.jsx("button",{onClick:ae,disabled:t.players.length<5,className:`w-full py-4 rounded-xl font-bold text-lg shadow-lg transition-all flex items-center justify-center gap-2 ${t.players.length>=5?"bg-green-700 hover:bg-green-600 text-white shadow-green-900/20":"bg-gray-800 cursor-not-allowed text-gray-500"}`,children:t.players.length<5?"Need more Agents...":"Execute Protocol"}):e.jsx("div",{className:"text-center text-cyan-400/60 animate-pulse font-serif italic",children:"Waiting for Admin command..."})]}),e.jsx(F,{})]})}if(u==="game"&&t){const a=t.players.find(r=>r.id===o.uid),s=a.isLeader,n=a.role,l=_[t.players.length]?.[t.currentMissionIndex]||0;5-t.failedVoteCount;const N=t.players.filter(r=>r.role==="MOLE"),d=n==="MOLE";return e.jsxs("div",{className:"min-h-screen bg-gray-950 text-white flex flex-col relative overflow-hidden font-sans",children:[e.jsx(R,{}),E&&e.jsx(pt,{type:E.type,message:E.message,subtext:E.subtext,icon:E.type==="success"?z:xe}),Z&&e.jsx(be,{onClose:()=>L(!1)}),$&&e.jsx(bt,{logs:t.logs,onClose:()=>Q(!1)}),J&&e.jsx(he,{onConfirmLeave:te,onCancel:()=>M(!1),isHost:t.hostId===o.uid,onConfirmLobby:()=>{ne(),M(!1)},inGame:!0}),e.jsxs("div",{className:"h-14 bg-gray-900/80 border-b border-gray-800 flex items-center justify-between px-4 z-50 backdrop-blur-md sticky top-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-serif text-cyan-500 font-bold tracking-wider hidden md:block",children:"PROTOCOL"}),e.jsx("span",{className:"text-xs text-gray-500 bg-black/50 px-2 py-1 rounded",children:"Sabotage Hall"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>L(!0),className:"p-2 hover:bg-gray-800 rounded text-gray-400",children:e.jsx(U,{size:18})}),e.jsx("button",{onClick:()=>Q(!$),className:`p-2 rounded-full ${$?"bg-cyan-900 text-cyan-400":"text-gray-400 hover:bg-gray-800"}`,children:e.jsx(ve,{size:18})}),e.jsx("button",{onClick:()=>M(!0),className:"p-2 hover:bg-red-900/50 rounded text-red-400",children:e.jsx(B,{size:18})})]})]}),e.jsxs("div",{className:"flex-1 p-2 md:p-4 flex flex-col items-center relative z-10 max-w-6xl mx-auto w-full gap-4",children:[e.jsx("div",{className:"w-full max-w-2xl bg-gray-900/80 p-3 rounded-xl border border-gray-700 flex justify-between items-center gap-2",children:t.missionHistory.map((r,g)=>{const p=_[t.players.length]?.[g]||"?",j=g===t.currentMissionIndex;return e.jsx("div",{className:`
                                flex-1 h-16 rounded-lg flex flex-col items-center justify-center border-2 transition-all
                                ${j?"border-yellow-400 bg-yellow-900/20 scale-105":"border-gray-700 bg-gray-800"}
                                ${r===!0?"bg-cyan-600 border-cyan-400":""}
                                ${r===!1?"bg-red-600 border-red-400":""}
                            `,children:r===null?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`text-lg font-bold ${j?"text-yellow-400":"text-gray-500"}`,children:p}),e.jsx("span",{className:"text-[9px] text-gray-500 uppercase",children:"Agents"})]}):r?e.jsx(z,{className:"text-white"}):e.jsx(at,{className:"text-white"})},g)})}),e.jsx("div",{className:"flex gap-4 text-xs font-bold uppercase tracking-widest text-gray-400",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ie,{size:14,className:t.failedVoteCount>3?"text-red-500":"text-gray-500"}),"Fails:"," ",e.jsxs("span",{className:"text-white",children:[t.failedVoteCount,"/5"]})]})}),e.jsx("div",{className:"flex gap-3 justify-center flex-wrap w-full my-4",children:t.players.map(r=>{const g=t.proposedTeam?.includes(r.id),p=r.isLeader,j=t.votes&&t.votes[r.id]!==void 0,m=t.votes?.[r.id],T=t.turnState!=="VOTING"&&j,G=d&&r.role==="MOLE"&&r.id!==o.uid;return e.jsxs("div",{onClick:()=>s&&t.turnState==="PICKING"?Pe(r.id):null,className:`
                                    relative bg-gray-900/90 p-3 rounded-xl border-2 w-32 md:w-40 transition-all cursor-pointer flex flex-col items-center
                                    ${p?"border-yellow-500 shadow-yellow-900/20 shadow-lg":"border-gray-700"}
                                    ${g?"ring-2 ring-cyan-400 bg-cyan-900/30":""}
                                `,children:[e.jsxs("div",{className:"absolute top-1 right-1",children:[p&&e.jsx(W,{size:12,className:"text-yellow-500"}),G&&e.jsx(we,{size:12,className:"text-red-500"})]}),e.jsx(ce,{size:24,className:r.id===o.uid?"text-cyan-400":"text-gray-500"}),e.jsx("span",{className:`font-bold text-sm truncate w-full text-center mt-1 ${r.id===o.uid?"text-cyan-200":"text-gray-300"}`,children:r.name}),e.jsxs("div",{className:"mt-2 h-4 flex items-center justify-center w-full",children:[t.turnState==="VOTING"&&j&&e.jsx("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-pulse"}),T&&(m?e.jsx(ue,{size:12,className:"text-green-400"}):e.jsx(me,{size:12,className:"text-red-400"})),t.turnState==="MISSION"&&t.proposedTeam.includes(r.id)&&(t.missionMoves[r.id]?e.jsx(rt,{size:12,className:"text-cyan-400"}):e.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full animate-bounce"}))]})]},r.id)})}),e.jsxs("div",{className:"w-full max-w-2xl bg-gray-900/95 p-4 rounded-t-3xl border-t border-cyan-500/30 backdrop-blur-md mt-auto shadow-2xl z-20",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 pb-4 border-b border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`p-2 rounded-lg ${n==="MOLE"?"bg-red-900/20 border border-red-500":"bg-cyan-900/20 border border-cyan-500"}`,children:n==="MOLE"?e.jsx(xe,{size:20,className:"text-red-400"}):e.jsx(Ne,{size:20,className:"text-cyan-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-gray-500 uppercase tracking-wider",children:"Your Role"}),e.jsx("div",{className:`font-black text-xl ${n==="MOLE"?"text-red-400":"text-cyan-400"}`,children:n})]})]}),n==="MOLE"&&e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-[10px] text-gray-500 uppercase tracking-wider",children:"Fellow Moles"}),e.jsx("div",{className:"text-red-300 text-xs font-bold",children:N.map(r=>r.name).join(", ")})]})]}),e.jsx("div",{className:"min-h-[80px] flex items-center justify-center",children:t.status==="finished"?e.jsxs("div",{className:"w-full text-center",children:[e.jsxs("h3",{className:`text-2xl font-black mb-4 ${t.winner==="OPERATIVES"?"text-cyan-400":"text-red-500"}`,children:[t.winner," WIN"]}),e.jsx("div",{className:"flex flex-wrap justify-center gap-2 mb-6",children:t.players.map(r=>e.jsxs("div",{className:`px-3 py-1 rounded-full text-[10px] uppercase font-bold border ${r.ready?"bg-green-900/30 border-green-500 text-green-400":"bg-gray-800 border-gray-600 text-gray-500"}`,children:[r.name," ",r.ready&&"âœ“"]},r.id))}),t.hostId===o.uid?e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsxs("button",{onClick:ae,disabled:!t.players.every(r=>r.ready),className:"bg-cyan-600 hover:bg-cyan-500 disabled:opacity-50 disabled:cursor-not-allowed px-6 py-3 rounded-xl font-bold text-white flex gap-2 items-center",children:[e.jsx(Se,{size:18})," Restart"]}),e.jsxs("button",{onClick:ne,disabled:!t.players.every(r=>r.ready),className:"bg-gray-700 hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed px-6 py-3 rounded-xl font-bold text-white flex gap-2 items-center",children:[e.jsx(ke,{size:18})," Lobby"]})]}),!t.players.every(r=>r.ready)&&e.jsx("span",{className:"text-xs text-gray-500 animate-pulse mt-2",children:"Waiting for all agents to report ready..."}),!a.ready&&e.jsx("button",{onClick:se,className:"mt-2 text-xs text-cyan-400 hover:text-cyan-300 underline",children:"Mark Self Ready"})]}):e.jsxs("div",{className:"w-full",children:[e.jsx("button",{onClick:se,className:`w-full py-3 rounded-xl font-bold text-lg shadow-lg transition-all mb-2 ${a.ready?"bg-green-600/20 border border-green-500 text-green-400":"bg-cyan-700 hover:bg-cyan-600 text-white"}`,children:a.ready?"READY - STANDING BY":"MARK READY"}),e.jsx("div",{className:"text-gray-500 italic text-xs",children:"Waiting for Host command..."})]})]}):e.jsxs(e.Fragment,{children:[t.turnState==="PICKING"&&(s?e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"text-center text-gray-400 text-sm mb-2",children:["Select ",l," Agents for the Mission"]}),e.jsx("button",{onClick:De,disabled:t.proposedTeam?.length!==l,className:"w-full bg-yellow-600 hover:bg-yellow-500 disabled:opacity-30 disabled:cursor-not-allowed text-black py-4 rounded-xl font-bold text-lg shadow-lg",children:"PROPOSE TEAM"})]}):e.jsx("div",{className:"text-center text-gray-500 animate-pulse",children:"Leader is selecting a team..."})),t.turnState==="VOTING"&&(t.votes[o.uid]===void 0?e.jsxs("div",{className:"flex gap-4 w-full",children:[e.jsxs("button",{onClick:()=>re(!0),className:"flex-1 bg-gray-800 hover:bg-gray-700 border-2 border-green-500/50 py-4 rounded-xl text-green-400 font-bold flex flex-col items-center gap-1",children:[e.jsx(ue,{})," APPROVE"]}),e.jsxs("button",{onClick:()=>re(!1),className:"flex-1 bg-gray-800 hover:bg-gray-700 border-2 border-red-500/50 py-4 rounded-xl text-red-400 font-bold flex flex-col items-center gap-1",children:[e.jsx(me,{})," REJECT"]})]}):e.jsx("div",{className:"text-center text-gray-500",children:"Vote Registered. Waiting for others..."})),t.turnState==="MISSION"&&(t.proposedTeam.includes(o.uid)?t.missionMoves[o.uid]?e.jsx("div",{className:"text-center text-cyan-400 font-bold",children:"Mission Move Locked In."}):e.jsxs("div",{className:"flex gap-4 w-full",children:[e.jsx("button",{onClick:()=>oe("SUCCESS"),className:"flex-1 bg-linear-to-br from-blue-600 to-cyan-600 hover:from-blue-500 hover:to-cyan-500 text-white py-4 rounded-xl font-bold shadow-lg shadow-cyan-900/20",children:"SUCCESS"}),n==="MOLE"&&e.jsx("button",{onClick:()=>oe("SABOTAGE"),className:"flex-1 bg-linear-to-br from-red-600 to-orange-600 hover:from-red-500 hover:to-orange-500 text-white py-4 rounded-xl font-bold shadow-lg shadow-red-900/20",children:"SABOTAGE"})]}):e.jsx("div",{className:"text-center text-gray-500 animate-pulse",children:"Mission in progress..."}))]})})]})]}),e.jsx(F,{})]})}return null}Ze.createRoot(document.getElementById("root")).render(e.jsx(c.StrictMode,{children:e.jsx(jt,{})}));
